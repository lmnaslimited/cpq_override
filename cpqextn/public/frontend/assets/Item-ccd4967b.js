import{_ as E}from"./Icon-b0abef9d.js";import{_ as j,a as M}from"./SidePanelModal-05261a36.js";import{u as R,A as B,E as P,_ as W}from"./useActiveTabManager-eb58b00a.js";import{C as z}from"./CommentIcon-2f8212cd.js";import{P as F}from"./PhoneIcon-d45a62b6.js";import{h as D,v as O,l as p,x as k,I as K,a as G,j as C,K as H,k as J,b as l,c as _,u as a,g as b,w as c,p as d,d as f,L as x,F as T,T as Q,e as h,t as X,f as Y,n as Z}from"./index-d057f33a.js";import{N as ee}from"./NoteModal-46cc4fb1.js";import{W as ae}from"./WhatsAppIcon-3fd08937.js";import{_ as te}from"./LayoutHeader-fe1f254b.js";import{_ as oe}from"./AssignmentModal-7b9977f2.js";import{_ as se}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-7b2c30ed.js";import{g as le,_ as ie}from"./view-66caf033.js";import{_ as re}from"./Section-1565df09.js";import{S as ne}from"./SectionFieldCpq-942892b4.js";import{g as me,u as de,h as ue,s as pe,i as ce,j as fe}from"./UserAvatar-e49c5291.js";import{s as _e}from"./statuses-72592e37.js";import{_ as be}from"./CustomActions-fd13eb50.js";import{c as ve}from"./contacts-62bb23c5.js";import{c as ye,w as Ie}from"./settings-0248bbea.js";import"./EditIcon-a130850d.js";import"./views-fe454bb1.js";import"./Dropdown.vue_vue_type_script_setup_true_lang-bf1a1150.js";import"./DragVerticalIcon-87005af9.js";import"./Switch.vue_vue_type_script_setup_true_lang-3dc67c0d.js";import"./GroupByIcon-a605d43f.js";import"./Email2Icon-e2d51718.js";import"./CalendarIcon-236853ad.js";import"./callLog-55eb7109.js";import"./MultipleAvatar-9bfce769.js";import"./Dropdown-ddb0640f.js";import"./FadedScrollableDiv-9f66556a.js";import"./FileUploader-1f4a7957.js";import"./LeadsIcon-520efb00.js";import"./DealsIcon-15068e15.js";import"./EmailTemplateModal-9954264c.js";import"./TaskModal-817b477f.js";import"./ArrowUpRightIcon-f89323ee.js";import"./IndicatorIcon-c103771d.js";const ge={key:1,class:"flex h-full overflow-hidden"},we={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},xe={class:"flex flex-col overflow-y-auto"},na={__name:"Item",props:{itemId:{type:String,required:!0}},setup(S){const{$dialog:$,$socket:q,makeCall:Ve}=me();ve(),_e(),de();const i=D(),A=O();p(!1);const v=S,I=p([]),N=p([]),t=k({url:"crm.api.docCpq.get_item",params:{name:v.itemId},cache:["item",v.itemId],onSuccess:async o=>{let e={doc:o,$dialog:$,$socket:q,router:A,createToast:ue,resource:{item:t,fieldsLayout:u},call:K};pe(o);let m=await ce(o,e);I.value=m.actions||[],N.value=m.statuses||[]}});G(()=>{t.data||t.fetch().catch(o=>{})});const V=p(!1),g=p(!1),w=p(!1),U=C(()=>{let o=[{label:__("Items"),route:{name:"Items"}}];if(i.query.view||i.query.viewType){let e=le(i.query.view,i.query.viewType,"Design");e&&o.push({label:__(e.label),icon:e.icon,route:{name:"Items",params:{viewType:i.query.viewType},query:{view:i.query.view}}})}return o.push({label:t.data.name||__("Untitled"),route:{name:"Item",params:{itemId:t.data.name}}}),o});H(()=>{var o,e;return{title:((o=t.data)==null?void 0:o.name)||((e=t.data)==null?void 0:e.name)}});const y=C(()=>[{name:"Activity",label:__("Activity"),icon:B},{name:"Emails",label:__("Emails"),icon:P},{name:"Comments",label:__("Comments"),icon:z},{name:"Calls",label:__("Calls"),icon:F,condition:()=>ye.value},{name:"Tasks",label:__("Tasks"),icon:Q},{name:"Notes",label:__("Notes"),icon:ee},{name:"WhatsApp",label:__("WhatsApp"),icon:ae,condition:()=>Ie.value}].filter(e=>e.condition?e.condition():!0)),{tabIndex:n}=R(y,"lastItemTab");J(y,o=>{if(o&&i.params.tabName){let e=o.findIndex(m=>m.name.toLowerCase()===i.params.tabName.toLowerCase());e!==-1&&(n.value=e)}});const u=k({url:"crm.api.docCpq.get_sidebar_fields_with_table",cache:["fieldsLayout",v.itemId],params:{doctype:"Item",name:v.itemId},auto:!0});return(o,e)=>{var m;return l(),_(T,null,[a(t).data?(l(),b(te,{key:0},{"left-header":c(()=>[f(a(se),{items:U.value},{prefix:c(({item:s})=>[s.icon?(l(),b(E,{key:0,icon:s.icon,class:"mr-2 h-4"},null,8,["icon"])):d("",!0)]),_:1},8,["items"])]),"right-header":c(()=>[I.value?(l(),b(be,{key:0,actions:I.value},null,8,["actions"])):d("",!0)]),_:1})):d("",!0),(m=a(t))!=null&&m.data?(l(),_("div",ge,[f(a(ie),{modelValue:a(n),"onUpdate:modelValue":e[3]||(e[3]=s=>x(n)?n.value=s:null),tabs:y.value},{default:c(({tab:s})=>[f(W,{ref:"activities",doctype:"Item",tabs:y.value,reload:V.value,"onUpdate:reload":e[0]||(e[0]=r=>V.value=r),tabIndex:a(n),"onUpdate:tabIndex":e[1]||(e[1]=r=>x(n)?n.value=r:null),modelValue:a(t),"onUpdate:modelValue":e[2]||(e[2]=r=>x(t)?t.value=r:null)},null,8,["tabs","reload","tabIndex","modelValue"])]),_:1},8,["modelValue","tabs"]),f(j,{class:"flex flex-col justify-between border-l",side:"right"},{default:c(()=>[h("div",{class:"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium",onClick:e[4]||(e[4]=s=>a(fe)(a(t).data.name))},X(o.__(a(t).data.name)),1),a(u).data?(l(),_("div",we,[h("div",xe,[(l(!0),_(T,null,Y(a(u).data,(s,r)=>(l(),_("div",{key:s.label,class:Z(["flex flex-col p-3",{"border-b":r!==a(u).data.length-1}])},[f(re,{"is-opened":s.opened,label:s.label},{default:c(()=>[f(ne,{fields:s.fields,isLastSection:r==a(u).data.length-1,modelValue:a(t).data,"onUpdate:modelValue":e[5]||(e[5]=L=>a(t).data=L)},null,8,["fields","isLastSection","modelValue"])]),_:2},1032,["is-opened","label"])],2))),128))])])):d("",!0)]),_:1})])):d("",!0),g.value?(l(),b(oe,{key:2,modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=s=>g.value=s),assignees:a(t).data._assignedTo,"onUpdate:assignees":e[7]||(e[7]=s=>a(t).data._assignedTo=s),doc:a(t).data,doctype:"Item"},null,8,["modelValue","assignees","doc"])):d("",!0),w.value?(l(),b(M,{key:3,modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=s=>w.value=s),onReload:e[9]||(e[9]=()=>a(u).reload())},null,8,["modelValue"])):d("",!0)],64)}}};export{na as default};
//# sourceMappingURL=Item-ccd4967b.js.map
