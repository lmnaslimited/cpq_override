import{m as _e,i as ee,v as pe,l as y,y as ue,x as te,j as F,a as me,r as U,b as o,g as k,w as C,e as m,t as w,u as h,d as c,p as f,z as ve,A as fe,h as ge,c as v,F as be,n as ae,T as se,q as ye,B as j}from"./index-d057f33a.js";import{_ as ke}from"./ViewBreadcrumbs-27963285.js";import{_ as xe}from"./MultipleAvatar-9bfce769.js";import{_ as Ce}from"./CustomActions-fd13eb50.js";import{E as we}from"./EmailAtIcon-5f694637.js";import{P as he}from"./PhoneIcon-d45a62b6.js";import{_ as Ve,N as le}from"./NoteModal-46cc4fb1.js";import{C as De}from"./CommentIcon-2f8212cd.js";import{I as H}from"./IndicatorIcon-c103771d.js";import{D as Ee}from"./DealsIcon-15068e15.js";import{_ as Me}from"./LayoutHeader-fe1f254b.js";import{_ as ze}from"./DealsListView-e9610059.js";import{_ as $e}from"./KanbanView-0129a26b.js";import{E as Ue}from"./EditIcon-a130850d.js";import{F as Se}from"./Fields-6a34413d.js";import{u as re,g as Ie,w as Re,e as Te,t as X,d as Y,f as Ae,b as P,_ as oe,c as Z}from"./UserAvatar-e49c5291.js";import{s as ie}from"./statuses-72592e37.js";import{_ as ne}from"./Switch.vue_vue_type_script_setup_true_lang-3dc67c0d.js";import{T as qe}from"./TaskModal-817b477f.js";import{_ as Oe}from"./QuickEntryModal-6386ea24.js";import{_ as Le}from"./ViewControls-57997287.js";import{o as Be}from"./organizations-30571208.js";import{c as je}from"./settings-0248bbea.js";import{_ as Pe}from"./Dropdown.vue_vue_type_script_setup_true_lang-bf1a1150.js";import"./Icon-b0abef9d.js";import"./Dropdown-ddb0640f.js";import"./ArrowUpRightIcon-f89323ee.js";import"./views-fe454bb1.js";import"./ListBulkActions-4e019d04.js";import"./NestedPopover-545deb9d.js";import"./AssignmentModal-7b9977f2.js";import"./ListRows-b9dc126d.js";import"./ListFooter-8173dedc.js";import"./GroupByIcon-a605d43f.js";import"./DragVerticalIcon-87005af9.js";import"./PinIcon-1aaff3df.js";import"./FadedScrollableDiv-9f66556a.js";import"./DetailsIcon-ef5d1277.js";const Qe={class:"bg-white px-4 pb-6 pt-5 sm:px-6"},Ke={class:"mb-5 flex items-center justify-between"},We={class:"text-2xl font-semibold leading-6 text-gray-900"},Ge={class:"flex items-center gap-1"},Je={class:"mb-4 grid grid-cols-1 gap-4 sm:grid-cols-3"},He={class:"flex items-center gap-3 text-sm text-gray-600"},Xe={class:"flex items-center gap-3 text-sm text-gray-600"},Ye={class:"px-4 pb-7 pt-4 sm:px-6"},Ze={class:"flex flex-row-reverse gap-2"},Fe={__name:"DealModal",props:_e({defaults:Object},{modelValue:{},modelModifiers:{},quickEntry:{},quickEntryModifiers:{}}),emits:["update:modelValue","update:quickEntry"],setup(O){const Q=O,{getUser:S,isManager:K}=re(),{getDealStatus:L,statusOptions:T}=ie(),D=ee(O,"modelValue"),E=pe(),g=y(null),d=ue({organization:"",organization_name:"",website:"",no_of_employees:"",territory:"",annual_revenue:"",industry:"",contact:"",salutation:"",first_name:"",last_name:"",email:"",mobile_no:"",gender:"",status:"",deal_owner:""}),u=y(!1),z=y(!1),$=y(!1),A=te({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["quickEntryFields","CRM Deal"],params:{doctype:"CRM Deal",type:"Quick Entry"},auto:!0,transform:i=>i.forEach(b=>{b.fields.forEach(p=>{p.name=="status"?(p.type="Select",p.options=l.value,p.prefix=L(d.status).iconColorClass):p.name=="deal_owner"&&(p.type="User")})})}),V=F(()=>{let i=A.data||[];if(!i.length)return[];let b=[];return $.value?b.push(i.find(p=>p.label==="Select Organization")):b.push(i.find(p=>p.label==="Organization Details")),z.value?b.push(i.find(p=>p.label==="Select Contact")):b.push(i.find(p=>p.label==="Contact Details")),i.forEach(p=>{["Select Organization","Organization Details","Select Contact","Contact Details"].includes(p.label)||b.push(p)}),b}),l=F(()=>{let i=T("deal");return d.status||(d.status=i[0].value),i});function q(){d.website&&!d.website.startsWith("http")&&(d.website="https://"+d.website),te({url:"crm.fcrm.doctype.crm_deal.crm_deal.create_deal",params:{args:d},auto:!0,validate(){if(g.value=null,d.annual_revenue&&(d.annual_revenue=d.annual_revenue.replace(/,/g,""),isNaN(d.annual_revenue)))return g.value=__("Annual Revenue should be a number"),g.value;if(d.mobile_no&&isNaN(d.mobile_no.replace(/[-+() ]/g,"")))return g.value=__("Mobile No should be a number"),g.value;if(d.email&&!d.email.includes("@"))return g.value=__("Invalid Email"),g.value;if(!d.status)return g.value=__("Status is required"),g.value;u.value=!0},onSuccess(i){ve("deal_created"),u.value=!1,D.value=!1,E.push({name:"Deal",params:{dealId:i}})},onError(i){if(u.value=!1,!i.messages){g.value=i.message;return}g.value=i.messages.join(`
`)}})}const W=ee(O,"quickEntry");function G(){W.value=!0,fe(()=>{D.value=!1})}return me(()=>{Object.assign(d,Q.defaults),d.deal_owner||(d.deal_owner=S().name),!d.status&&l.value[0].value&&(d.status=l.value[0].value)}),(i,b)=>{const p=U("Button"),I=U("FeatherIcon"),R=U("ErrorMessage"),J=U("Dialog");return o(),k(J,{modelValue:D.value,"onUpdate:modelValue":b[3]||(b[3]=M=>D.value=M),options:{size:"3xl"}},{body:C(()=>[m("div",Qe,[m("div",Ke,[m("div",null,[m("h3",We,w(i.__("Create Deal")),1)]),m("div",Ge,[h(K)()?(o(),k(p,{key:0,variant:"ghost",class:"w-7",onClick:G},{default:C(()=>[c(Ue,{class:"h-4 w-4"})]),_:1})):f("",!0),c(p,{variant:"ghost",class:"w-7",onClick:b[0]||(b[0]=M=>D.value=!1)},{default:C(()=>[c(I,{name:"x",class:"h-4 w-4"})]),_:1})])]),m("div",null,[m("div",Je,[m("div",He,[m("div",null,w(i.__("Choose Existing Organization")),1),c(h(ne),{modelValue:$.value,"onUpdate:modelValue":b[1]||(b[1]=M=>$.value=M)},null,8,["modelValue"])]),m("div",Xe,[m("div",null,w(i.__("Choose Existing Contact")),1),c(h(ne),{modelValue:z.value,"onUpdate:modelValue":b[2]||(b[2]=M=>z.value=M)},null,8,["modelValue"])])]),V.value?(o(),k(Se,{key:0,class:"border-t pt-4",sections:V.value,data:d},null,8,["sections","data"])):f("",!0),g.value?(o(),k(R,{key:1,class:"mt-4",message:i.__(g.value)},null,8,["message"])):f("",!0)])]),m("div",Ye,[m("div",Ze,[c(p,{variant:"solid",label:i.__("Create"),loading:u.value,onClick:q},null,8,["label","loading"])])])]),_:1},8,["modelValue"])}}},Ne={class:"flex gap-2 items-center"},et={key:0},tt={key:1},at={key:2},st={key:3,class:"truncate text-base"},lt={key:4,class:"truncate text-base"},ot={key:5,class:"truncate text-base"},nt={key:6,class:"text-gray-500"},ut={key:0,class:"truncate flex items-center gap-2"},rt={key:0},it={key:1},ct={key:2},dt={key:3,class:"truncate text-base"},_t={key:4,class:"truncate text-base"},pt={key:5,class:"flex items-center"},mt={key:6,class:"truncate text-base"},vt={class:"flex gap-2 items-center justify-between"},ft={class:"text-gray-600 flex items-center gap-1.5"},gt={key:0},bt={key:1},yt={key:2},kt={key:3},xt={key:2,class:"flex h-full items-center justify-center"},Ct={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},ua={__name:"Deals",setup(O){const{makeCall:Q}=Ie(),{getUser:S}=re(),{getOrganization:K}=Be(),{getDealStatus:L}=ie(),T=ge(),D=y(null),E=y(!1),g=y(!1),d=ue({}),u=y({}),z=y(1),$=y(1),A=y(20),V=y(null);function l(r,e){var s;function n(_){return _&&typeof _=="object"&&!Array.isArray(_)?_:{label:_}}return n((s=q.value)==null?void 0:s.find(_=>_.name==r)[e])}const q=F(()=>{var r,e,n,s,_,t,a;return(e=(r=u.value)==null?void 0:r.data)!=null&&e.data?u.value.data.view_type==="group_by"?(s=(n=u.value)==null?void 0:n.data.group_by_field)!=null&&s.name?W((_=u.value)==null?void 0:_.data.data,(t=u.value)==null?void 0:t.data.group_by_field):[]:u.value.data.view_type==="kanban"?G(u.value.data.data):i((a=u.value)==null?void 0:a.data.data):[]});function W(r,e){var s;let n=[];return(s=e.options)==null||s.forEach(_=>{let t=[];_?t=r.filter(x=>x[e.name]==_):t=r.filter(x=>!x[e.name]);let a={label:e.label,group:_||__(" "),collapsed:!1,rows:i(t)};e.name=="status"&&(a.icon=()=>{var x;return j(H,{class:(x=L(_))==null?void 0:x.iconColorClass})}),n.push(a)}),n||r}function G(r){let e=[];return r.forEach(n=>{var s;(s=n.data)==null||s.forEach(_=>{e.push(_)})}),i(e)}function i(r){return r.map(e=>{let n={};return u.value.data.rows.forEach(s=>{var _,t;if(n[s]=e[s],s=="organization")n[s]={label:e.organization,logo:(_=K(e.organization))==null?void 0:_.organization_logo};else if(s==="website")n[s]=Re(e.website);else if(s=="annual_revenue")n[s]=Te(e.annual_revenue,e.currency);else if(s=="status")n[s]={label:e.status,color:(t=L(e.status))==null?void 0:t.iconColorClass};else if(s=="sla_status"){let a=e.sla_status,x=a,N=e.sla_status=="Failed"?"red":e.sla_status=="Fulfilled"?"green":"orange";a=="First Response Due"&&(a=__(X(e.response_by)),x=Y(e.response_by,Z),new Date(e.response_by)<new Date&&(N="red")),n[s]={label:x,value:a,color:N}}else if(s=="deal_owner")n[s]={label:e.deal_owner&&S(e.deal_owner).full_name,...e.deal_owner&&S(e.deal_owner)};else if(s=="_assign"){let a=JSON.parse(e._assign||"[]");!a.length&&e.deal_owner&&(a=[e.deal_owner]),n[s]=a.map(x=>({name:x,image:S(x).user_image,label:S(x).full_name}))}else if(["modified","creation"].includes(s))n[s]={label:Y(e[s],Z),timeAgo:__(X(e[s]))};else if(["first_response_time","first_responded_on","response_by"].includes(s)){let a=s=="response_by"?"response_by":"first_responded_on";n[s]={label:e[a]?Y(e[a],Z):"",timeAgo:e[s]?s=="first_response_time"?Ae(e[s]):__(X(e[s])):""}}}),n._email_count=e._email_count,n._note_count=e._note_count,n._task_count=e._task_count,n._comment_count=e._comment_count,n})}function b(r){let e=u.value.params.column_field;e&&(d[e]=r.column.name),E.value=!0}function p(r){var s;let e=((s=l(r,"mobile_no"))==null?void 0:s.label)||"";return[{icon:j(he,{class:"h-4 w-4"}),label:__("Make a Call"),onClick:()=>Q(e),condition:()=>e&&je.value},{icon:j(le,{class:"h-4 w-4"}),label:__("New Note"),onClick:()=>M(r)},{icon:j(se,{class:"h-4 w-4"}),label:__("New Task"),onClick:()=>de(r)}].filter(_=>_.condition?_.condition():!0)}const I=y(""),R=y(!1),J=y({title:"",content:""});function M(r){I.value=r,R.value=!0}const B=y(!1),ce=y({title:"",description:"",assigned_to:"",due_date:"",priority:"Low",status:"Backlog"});function de(r){I.value=r,B.value=!0}return(r,e)=>{const n=U("FeatherIcon"),s=U("Button"),_=U("Badge");return o(),v(be,null,[c(Me,null,{"left-header":C(()=>[c(ke,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=t=>V.value=t),routeName:"Deals"},null,8,["modelValue"])]),"right-header":C(()=>{var t;return[(t=D.value)!=null&&t.customListActions?(o(),k(Ce,{key:0,actions:D.value.customListActions},null,8,["actions"])):f("",!0),c(s,{variant:"solid",label:r.__("Create"),onClick:e[1]||(e[1]=a=>E.value=!0)},{prefix:C(()=>[c(n,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),c(Le,{ref_key:"viewControls",ref:V,modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value=t),loadMore:z.value,"onUpdate:loadMore":e[3]||(e[3]=t=>z.value=t),resizeColumn:$.value,"onUpdate:resizeColumn":e[4]||(e[4]=t=>$.value=t),updatedPageCount:A.value,"onUpdate:updatedPageCount":e[5]||(e[5]=t=>A.value=t),doctype:"CRM Deal",options:{allowedViews:["list","group_by","kanban"]}},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),h(T).params.viewType=="kanban"?(o(),k($e,{key:0,modelValue:u.value,"onUpdate:modelValue":e[7]||(e[7]=t=>u.value=t),options:{getRoute:t=>({name:"Deal",params:{dealId:t.name},query:{view:h(T).query.view,viewType:h(T).params.viewType}}),onNewClick:t=>b(t)},onUpdate:e[8]||(e[8]=t=>V.value.updateKanbanSettings(t)),onLoadMore:e[9]||(e[9]=t=>V.value.loadMoreKanban(t))},{title:C(({titleField:t,itemName:a})=>[m("div",Ne,[t==="status"?(o(),v("div",et,[c(H,{class:ae(l(a,t).color)},null,8,["class"])])):t==="organization"&&l(a,t).label?(o(),v("div",tt,[c(h(P),{class:"flex items-center",image:l(a,t).logo,label:l(a,t).label,size:"sm"},null,8,["image","label"])])):t==="deal_owner"&&l(a,t).full_name?(o(),v("div",at,[c(h(P),{class:"flex items-center",image:l(a,t).user_image,label:l(a,t).full_name,size:"sm"},null,8,["image","label"])])):f("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(t)?(o(),v("div",st,[c(h(oe),{text:l(a,t).label},{default:C(()=>[m("div",null,w(l(a,t).timeAgo),1)]),_:2},1032,["text"])])):t==="sla_status"?(o(),v("div",lt,[l(a,t).value?(o(),k(_,{key:0,variant:"subtle",theme:l(a,t).color,size:"md",label:l(a,t).value},null,8,["theme","label"])):f("",!0)])):l(a,t).label?(o(),v("div",ot,w(l(a,t).label),1)):(o(),v("div",nt,w(r.__("No Title")),1))])]),fields:C(({fieldName:t,itemName:a})=>[l(a,t).label?(o(),v("div",ut,[t==="status"?(o(),v("div",rt,[c(H,{class:ae(l(a,t).color)},null,8,["class"])])):t==="organization"?(o(),v("div",it,[l(a,t).label?(o(),k(h(P),{key:0,class:"flex items-center",image:l(a,t).logo,label:l(a,t).label,size:"xs"},null,8,["image","label"])):f("",!0)])):t==="deal_owner"?(o(),v("div",ct,[l(a,t).full_name?(o(),k(h(P),{key:0,class:"flex items-center",image:l(a,t).user_image,label:l(a,t).full_name,size:"xs"},null,8,["image","label"])):f("",!0)])):f("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(t)?(o(),v("div",dt,[c(h(oe),{text:l(a,t).label},{default:C(()=>[m("div",null,w(l(a,t).timeAgo),1)]),_:2},1032,["text"])])):t==="sla_status"?(o(),v("div",_t,[l(a,t).value?(o(),k(_,{key:0,variant:"subtle",theme:l(a,t).color,size:"md",label:l(a,t).value},null,8,["theme","label"])):f("",!0)])):t==="_assign"?(o(),v("div",pt,[c(xe,{avatars:l(a,t).label,size:"xs"},null,8,["avatars"])])):(o(),v("div",mt,w(l(a,t).label),1))])):f("",!0)]),actions:C(({itemName:t})=>[m("div",vt,[m("div",ft,[c(we,{class:"h-4 w-4"}),l(t,"_email_count").label?(o(),v("span",gt,w(l(t,"_email_count").label),1)):f("",!0),e[24]||(e[24]=m("span",{class:"text-3xl leading-[0]"}," · ",-1)),c(le,{class:"h-4 w-4"}),l(t,"_note_count").label?(o(),v("span",bt,w(l(t,"_note_count").label),1)):f("",!0),e[25]||(e[25]=m("span",{class:"text-3xl leading-[0]"}," · ",-1)),c(se,{class:"h-4 w-4"}),l(t,"_task_count").label?(o(),v("span",yt,w(l(t,"_task_count").label),1)):f("",!0),e[26]||(e[26]=m("span",{class:"text-3xl leading-[0]"}," · ",-1)),c(De,{class:"h-4 w-4"}),l(t,"_comment_count").label?(o(),v("span",kt,w(l(t,"_comment_count").label),1)):f("",!0)]),c(h(Pe),{class:"flex items-center gap-2",options:p(t),variant:"ghost",onClick:e[6]||(e[6]=ye(()=>{},["stop","prevent"]))},{default:C(()=>[c(s,{icon:"plus",variant:"ghost"})]),_:2},1032,["options"])])]),_:1},8,["modelValue","options"])):u.value.data&&q.value.length?(o(),k(ze,{key:1,ref_key:"dealsListView",ref:D,modelValue:u.value.data.page_length_count,"onUpdate:modelValue":e[10]||(e[10]=t=>u.value.data.page_length_count=t),list:u.value,"onUpdate:list":e[11]||(e[11]=t=>u.value=t),rows:q.value,columns:u.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:u.value.data.row_count,totalCount:u.value.data.total_count},onLoadMore:e[12]||(e[12]=()=>z.value++),onColumnWidthUpdated:e[13]||(e[13]=()=>$.value++),onUpdatePageCount:e[14]||(e[14]=t=>A.value=t),onApplyFilter:e[15]||(e[15]=t=>V.value.applyFilter(t)),onApplyLikeFilter:e[16]||(e[16]=t=>V.value.applyLikeFilter(t)),onLikeDoc:e[17]||(e[17]=t=>V.value.likeDoc(t))},null,8,["modelValue","list","rows","columns","options"])):u.value.data?(o(),v("div",xt,[m("div",Ct,[c(Ee,{class:"h-10 w-10"}),m("span",null,w(r.__("No {0} Found",[r.__("Deals")])),1),c(s,{label:r.__("Create"),onClick:e[18]||(e[18]=t=>E.value=!0)},{prefix:C(()=>[c(n,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):f("",!0),E.value?(o(),k(Fe,{key:3,modelValue:E.value,"onUpdate:modelValue":e[19]||(e[19]=t=>E.value=t),quickEntry:g.value,"onUpdate:quickEntry":e[20]||(e[20]=t=>g.value=t),defaults:d},null,8,["modelValue","quickEntry","defaults"])):f("",!0),R.value?(o(),k(Ve,{key:4,modelValue:R.value,"onUpdate:modelValue":e[21]||(e[21]=t=>R.value=t),note:J.value,doctype:"CRM Deal",doc:I.value},null,8,["modelValue","note","doc"])):f("",!0),B.value?(o(),k(qe,{key:5,modelValue:B.value,"onUpdate:modelValue":e[22]||(e[22]=t=>B.value=t),task:ce.value,doctype:"CRM Deal",doc:I.value},null,8,["modelValue","task","doc"])):f("",!0),g.value?(o(),k(Oe,{key:6,modelValue:g.value,"onUpdate:modelValue":e[23]||(e[23]=t=>g.value=t),doctype:"CRM Deal"},null,8,["modelValue"])):f("",!0)],64)}}};export{ua as default};
//# sourceMappingURL=Deals-76d685e1.js.map
