import{_ as Y}from"./Icon-b0abef9d.js";import{D as Z}from"./DetailsIcon-ef5d1277.js";import{u as ee,A as te,E as ae,S as se,_ as oe}from"./useActiveTabManager-eb58b00a.js";import{C as ne}from"./CommentIcon-2f8212cd.js";import{P as ie}from"./PhoneIcon-d45a62b6.js";import{h as le,v as re,l as D,x as T,I as O,a as de,j as N,k as me,r as A,b as n,c as m,u as a,g as u,w as p,p as f,G as ue,e as r,d as l,L as S,F as L,T as pe,n as M,f as ce,t as v}from"./index-d057f33a.js";import{N as fe}from"./NoteModal-46cc4fb1.js";import{W as _e}from"./WhatsAppIcon-3fd08937.js";import{I as ge}from"./IndicatorIcon-c103771d.js";import{O as ve}from"./OrganizationsIcon-321405d1.js";import{C as be}from"./ContactsIcon-f7db653d.js";import{_ as ye}from"./LayoutHeader-fe1f254b.js";import{_ as Ce}from"./AssignmentModal-7b9977f2.js";import{_ as we}from"./MultipleAvatar-9bfce769.js";import{_ as j}from"./views-fe454bb1.js";import{_ as he}from"./Section-1565df09.js";import{S as xe}from"./SLASection-51b98e40.js";import{_ as De}from"./CustomActions-fd13eb50.js";import{g as Ve,h as V,s as Ie,i as ke}from"./UserAvatar-e49c5291.js";import{g as Te,_ as Ae}from"./view-66caf033.js";import{c as Se}from"./contacts-62bb23c5.js";import{s as $e}from"./statuses-72592e37.js";import{i as ze,c as Ue,w as qe}from"./settings-0248bbea.js";import{_ as Ee}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-7b2c30ed.js";import{_ as Oe}from"./Dropdown.vue_vue_type_script_setup_true_lang-bf1a1150.js";import{_ as B}from"./Switch.vue_vue_type_script_setup_true_lang-3dc67c0d.js";import"./Email2Icon-e2d51718.js";import"./CalendarIcon-236853ad.js";import"./callLog-55eb7109.js";import"./Dropdown-ddb0640f.js";import"./FadedScrollableDiv-9f66556a.js";import"./FileUploader-1f4a7957.js";import"./LeadsIcon-520efb00.js";import"./DealsIcon-15068e15.js";import"./EmailTemplateModal-9954264c.js";import"./TaskModal-817b477f.js";import"./ArrowUpRightIcon-f89323ee.js";import"./GroupByIcon-a605d43f.js";const Ne={class:"relative flex h-12 items-center justify-between gap-2 py-2.5 pl-5"},Le={class:"absolute right-0"},Me={key:1,class:"flex h-12 items-center justify-between gap-2 border-b px-3 py-2.5"},je={class:"flex items-center gap-2"},Be={key:2,class:"flex h-full overflow-hidden"},Fe={key:0},Re={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},We={class:"flex flex-col overflow-y-auto"},Pe={class:"mb-4 flex items-center gap-2 text-gray-600"},Ge={class:"block text-base"},He={class:"ml-6"},Je={class:"flex items-center justify-between text-base"},Ke={key:1,class:"mt-2.5 text-base"},Qe={class:"mb-4 mt-6 flex items-center gap-2 text-gray-600"},Xe={class:"block text-base"},Ye={class:"ml-6"},Ze={class:"flex items-center justify-between text-base"},et={key:1,class:"mt-2.5 text-base"},Mt={__name:"MobileDesign",props:{designId:{type:String,required:!0}},setup(F){const{$dialog:R,$socket:W}=Ve();Se();const{statusOptions:P,getLeadStatus:G}=$e(),c=le(),$=re(),b=F,I=D([]),z=D([]),s=T({url:"crm.cpq.doctype.design.api.get_design",params:{name:b.designId},cache:["design",b.designId],onSuccess:async t=>{let e={doc:t,$dialog:R,$socket:W,router:$,updateField:h,createToast:V,deleteDoc:Q,resource:{design:s,fieldsLayout:y},call:O};Ie(t);let i=await ke(t,e);I.value=i.actions||[],z.value=i.statuses||[]}});de(()=>{s.data||s.fetch()});const k=D(!1),C=D(!1);function H(t,e,i){e=Array.isArray(t)?"":e,!(!Array.isArray(t)&&J(t,e))&&T({url:"frappe.client.set_value",params:{doctype:"Design",name:b.designId,fieldname:t,value:e},auto:!0,onSuccess:()=>{s.reload(),k.value=!0,V({title:__("Design updated"),icon:"check",iconClasses:"text-green-600"}),i==null||i()},onError:g=>{var x;V({title:__("Error updating design"),text:__((x=g.messages)==null?void 0:x[0]),icon:"x",iconClasses:"text-red-600"})}})}function J(t,e){var g;let i=s.data.fields_meta||{};return(g=i[t])!=null&&g.reqd&&!e?(V({title:__("Error Updating Design"),text:__("{0} is a required field",[i[t].label]),icon:"x",iconClasses:"text-red-600"}),!0):!1}const K=N(()=>{let t=[{label:__("Designs"),route:{name:"Designs"}}];if(c.query.view||c.query.viewType){let e=Te(c.query.view,c.query.viewType,"Design");e&&t.push({label:__(e.label),icon:e.icon,route:{name:"Designs",params:{viewType:c.query.viewType},query:{view:c.query.view}}})}return t.push({label:s.data.name||__("Untitled"),route:{name:"Design",params:{designId:s.data.name}}}),t}),w=N(()=>[{name:"Details",label:__("Details"),icon:Z,condition:()=>ze.value},{name:"Activity",label:__("Activity"),icon:te},{name:"Emails",label:__("Emails"),icon:ae},{name:"Comments",label:__("Comments"),icon:ne},{name:"Calls",label:__("Calls"),icon:ie,condition:()=>Ue.value},{name:"Tasks",label:__("Tasks"),icon:pe},{name:"Notes",label:__("Notes"),icon:fe},{name:"WhatsApp",label:__("WhatsApp"),icon:_e,condition:()=>qe.value}].filter(e=>e.condition?e.condition():!0)),{tabIndex:_}=ee(w,"lastDesignTab");me(w,t=>{if(t&&c.params.tabName){let e=t.findIndex(i=>i.name.toLowerCase()===c.params.tabName.toLowerCase());e!==-1&&(_.value=e)}});const y=T({url:"crm.api.doc.get_sidebar_fields",cache:["fieldsLayout",b.designId],params:{doctype:"Design",name:b.designId},auto:!0});function h(t,e,i){H(t,e,()=>{s.data[t]=e,i==null||i()})}async function Q(t){await O("frappe.client.delete",{doctype:"Design",name:t}),$.push({name:"Designs"})}return(t,e)=>{var U,q;const i=A("FeatherIcon"),g=A("Button"),x=A("Dialog");return n(),m(L,null,[a(s).data?(n(),u(ye,{key:0},{default:p(()=>[r("header",Ne,[l(a(Ee),{items:K.value},{prefix:p(({item:o})=>[o.icon?(n(),u(Y,{key:0,icon:o.icon,class:"mr-2 h-4"},null,8,["icon"])):f("",!0)]),_:1},8,["items"]),r("div",Le,[l(a(Oe),{options:a(P)("design",h,z.value)},{default:p(({open:o})=>[l(g,{label:a(s).data.status,class:M(a(G)(a(s).data.status).colorClass)},{prefix:p(()=>[l(ge)]),suffix:p(()=>[l(i,{name:o?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label","class"])]),_:1},8,["options"])])])]),_:1})):f("",!0),a(s).data?(n(),m("div",Me,[(n(),u(ue(((U=a(s).data._assignedTo)==null?void 0:U.length)==1?"Button":"div"),null,{default:p(()=>[l(we,{avatars:a(s).data._assignedTo,onClick:e[0]||(e[0]=o=>C.value=!0)},null,8,["avatars"])]),_:1})),r("div",je,[I.value?(n(),u(De,{key:0,actions:I.value},null,8,["actions"])):f("",!0),l(g,{label:t.__("Convert"),variant:"solid",onClick:e[1]||(e[1]=o=>t.showConvertToDealModal=!0)},null,8,["label"])])])):f("",!0),(q=a(s))!=null&&q.data?(n(),m("div",Be,[l(a(Ae),{modelValue:a(_),"onUpdate:modelValue":e[7]||(e[7]=o=>S(_)?_.value=o:null),tabs:w.value,tablistClass:"!px-3",class:"overflow-auto"},{default:p(({tab:o})=>[o.name=="Details"?(n(),m("div",Fe,[a(s).data.sla_status?(n(),u(xe,{key:0,modelValue:a(s).data,"onUpdate:modelValue":e[2]||(e[2]=d=>a(s).data=d),onUpdateField:h},null,8,["modelValue"])):f("",!0),a(y).data?(n(),m("div",Re,[r("div",We,[(n(!0),m(L,null,ce(a(y).data,(d,E)=>(n(),m("div",{key:d.label,class:M(["flex flex-col px-2 py-3 sm:p-3",{"border-b":E!==a(y).data.length-1}])},[l(he,{"is-opened":d.opened,label:d.label},{default:p(()=>[l(se,{fields:d.fields,isLastSection:E==a(y).data.length-1,modelValue:a(s).data,"onUpdate:modelValue":e[3]||(e[3]=X=>a(s).data=X),onUpdate:h},null,8,["fields","isLastSection","modelValue"])]),_:2},1032,["is-opened","label"])],2))),128))])])):f("",!0)])):(n(),u(oe,{key:1,doctype:"Design",tabs:w.value,reload:k.value,"onUpdate:reload":e[4]||(e[4]=d=>k.value=d),tabIndex:a(_),"onUpdate:tabIndex":e[5]||(e[5]=d=>S(_)?_.value=d:null),modelValue:a(s),"onUpdate:modelValue":e[6]||(e[6]=d=>S(s)?s.value=d:null)},null,8,["tabs","reload","tabIndex","modelValue"]))]),_:1},8,["modelValue","tabs"])])):f("",!0),C.value?(n(),u(Ce,{key:3,modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=o=>C.value=o),assignees:a(s).data._assignedTo,"onUpdate:assignees":e[9]||(e[9]=o=>a(s).data._assignedTo=o),doc:a(s).data,doctype:"Design"},null,8,["modelValue","assignees","doc"])):f("",!0),l(x,{modelValue:t.showConvertToDealModal,"onUpdate:modelValue":e[14]||(e[14]=o=>t.showConvertToDealModal=o),options:{title:t.__("Convert to Deal"),size:"xl",actions:[{label:t.__("Convert"),variant:"solid",onClick:t.convertToDeal}]}},{"body-content":p(()=>[r("div",Pe,[l(ve,{class:"h-4 w-4"}),r("label",Ge,v(t.__("Organization")),1)]),r("div",He,[r("div",Je,[r("div",null,v(t.__("Choose Existing")),1),l(a(B),{modelValue:t.existingOrganizationChecked,"onUpdate:modelValue":e[10]||(e[10]=o=>t.existingOrganizationChecked=o)},null,8,["modelValue"])]),t.existingOrganizationChecked?(n(),u(j,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:t.existingOrganization,doctype:"CRM Organization",onChange:e[11]||(e[11]=o=>t.existingOrganization=o)},null,8,["value"])):(n(),m("div",Ke,v(t.__("New organization will be created based on the data in details section")),1))]),r("div",Qe,[l(be,{class:"h-4 w-4"}),r("label",Xe,v(t.__("Contact")),1)]),r("div",Ye,[r("div",Ze,[r("div",null,v(t.__("Choose Existing")),1),l(a(B),{modelValue:t.existingContactChecked,"onUpdate:modelValue":e[12]||(e[12]=o=>t.existingContactChecked=o)},null,8,["modelValue"])]),t.existingContactChecked?(n(),u(j,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:t.existingContact,doctype:"Contact",onChange:e[13]||(e[13]=o=>t.existingContact=o)},null,8,["value"])):(n(),m("div",et,v(t.__("New contact will be created based on the person's details")),1))])]),_:1},8,["modelValue","options"])],64)}}};export{Mt as default};
//# sourceMappingURL=MobileDesign-311b3e78.js.map
