import{_ as K}from"./CustomActions-fd13eb50.js";import{_ as Q}from"./LayoutHeader-fe1f254b.js";import{_ as X}from"./ViewControls-57997287.js";import{m as q,h as Y,i as E,j as L,s as Z,k as P,l as $,r as U,b as l,c as C,d as _,w as y,u as h,F as S,f as ee,g as x,n as B,p as V,e as M,t as z,q as te,_ as O,y as W,a as H,N as se,O as ae,v as ne,x as oe,P as le,I as j,z as ie}from"./index-d057f33a.js";import{_ as re,H as N,a as ue,b as de,c as me,d as ce,e as pe}from"./ListBulkActions-4e019d04.js";import{I as _e}from"./IndicatorIcon-c103771d.js";import{_ as ge}from"./MultipleAvatar-9bfce769.js";import{_ as fe}from"./ListRows-b9dc126d.js";import{b as A,_ as ve,u as J}from"./UserAvatar-e49c5291.js";import{_ as ye}from"./Dropdown.vue_vue_type_script_setup_true_lang-bf1a1150.js";import{_ as ke}from"./ListFooter-8173dedc.js";import{F as Ce}from"./Fields-6a34413d.js";import{s as be}from"./statuses-72592e37.js";import{_ as he}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-7b2c30ed.js";import"./settings-0248bbea.js";import"./GroupByIcon-a605d43f.js";import"./views-fe454bb1.js";import"./NestedPopover-545deb9d.js";import"./EditIcon-a130850d.js";import"./PinIcon-1aaff3df.js";import"./FadedScrollableDiv-9f66556a.js";import"./DetailsIcon-ef5d1277.js";import"./DragVerticalIcon-87005af9.js";import"./AssignmentModal-7b9977f2.js";const we={key:0,class:"flex items-center"},xe={key:0},Ve={key:1},$e={key:2},Fe={key:3},De=["onClick"],Me={key:1},Ue={key:2,class:"truncate text-base"},Ie={key:3},ze=["onClick"],Be={__name:"DesignsListView",props:q({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:q(["loadMore","updatePageCount","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc"],["update:modelValue","update:list"]),setup(g,{expose:f,emit:b}){const m=b,d=Y(),c=E(g,"modelValue"),p=E(g,"list"),o=L(()=>{var e,n;return!!((n=(e=p.value.params)==null?void 0:e.filters)!=null&&n._liked_by)}),{user:r}=Z();function i(e){if(e)return JSON.parse(e).includes(r)}P(c,(e,n)=>{e!==n&&m("updatePageCount",e)});const t=$(null);return f({customListActions:L(()=>{var e;return(e=t.value)==null?void 0:e.customListActions})}),(e,n)=>{const w=U("Button"),u=U("Badge"),R=U("FormControl");return l(),C(S,null,[_(h(ce),{class:B(e.$attrs.class),columns:g.columns,rows:g.rows,options:{getRowRoute:v=>({name:"Design",params:{designId:v.name},query:{view:h(d).query.view,viewType:h(d).params.viewType}}),selectable:g.options.selectable,showTooltip:g.options.showTooltip,resizeColumn:g.options.resizeColumn},"row-key":"name"},{default:y(()=>[_(h(re),{class:"sm:mx-5 mx-3",onColumnWidthUpdated:n[1]||(n[1]=v=>m("columnWidthUpdated"))},{default:y(()=>[(l(!0),C(S,null,ee(g.columns,v=>(l(),x(h(ue),{key:v.key,item:v,onColumnWidthUpdated:a=>m("columnWidthUpdated",v)},{default:y(()=>[v.key=="_liked_by"?(l(),x(w,{key:0,variant:"ghosted",class:B(["!h-4",o.value?"fill-red-500":"fill-white"]),onClick:n[0]||(n[0]=()=>m("applyLikeFilter"))},{default:y(()=>[_(N,{class:"h-4 w-4"})]),_:1},8,["class"])):V("",!0)]),_:2},1032,["item","onColumnWidthUpdated"]))),128))]),_:1}),_(fe,{rows:g.rows},{default:y(({idx:v,column:a,item:s,row:k})=>[a.key==="_assign"?(l(),C("div",we,[_(ge,{avatars:s,size:"sm",onClick:D=>m("applyFilter",{event:D,idx:v,column:a,item:s,firstColumn:g.columns[0]})},null,8,["avatars","onClick"])])):(l(),x(h(de),{key:1,item:s},{prefix:y(()=>[a.key==="status"?(l(),C("div",xe,[_(_e,{class:B(s.color)},null,8,["class"])])):a.key==="name"?(l(),C("div",Ve,[s.label?(l(),x(h(A),{key:0,class:"flex items-center",image:s.image,label:s.image_label,size:"sm"},null,8,["image","label"])):V("",!0)])):a.key==="organization"?(l(),C("div",$e,[s?(l(),x(h(A),{key:0,class:"flex items-center",image:s,label:s,size:"sm"},null,8,["image","label"])):V("",!0)])):a.key==="owner"?(l(),C("div",Fe,[s.full_name?(l(),x(h(A),{key:0,class:"flex items-center",image:s.user_image,label:s.full_name,size:"sm"},null,8,["image","label"])):V("",!0)])):V("",!0)]),default:y(({label:D})=>[["modified","creation","first_response_time","first_responded_on","response_by"].includes(a.key)?(l(),C("div",{key:0,class:"truncate text-base",onClick:F=>m("applyFilter",{event:F,idx:v,column:a,item:s,firstColumn:g.columns[0]})},[_(h(ve),{text:s.label},{default:y(()=>[M("div",null,z(s.timeAgo),1)]),_:2},1032,["text"])],8,De)):a.key==="_liked_by"?(l(),C("div",Me,[a.key=="_liked_by"?(l(),x(w,{key:0,variant:"ghosted",class:B(i(s)?"fill-red-500":"fill-white"),onClick:te(()=>m("likeDoc",{name:k.name,liked:i(s)}),["stop","prevent"])},{default:y(()=>[_(N,{class:"h-4 w-4"})]),_:2},1032,["class","onClick"])):V("",!0)])):a.key==="sla_status"?(l(),C("div",Ue,[s.value?(l(),x(u,{key:0,variant:"subtle",theme:s.color,size:"md",label:s.value,onClick:F=>m("applyFilter",{event:F,idx:v,column:a,item:s,firstColumn:g.columns[0]})},null,8,["theme","label","onClick"])):V("",!0)])):a.type==="Check"?(l(),C("div",Ie,[_(R,{type:"checkbox",modelValue:s,disabled:!0,class:"text-gray-900"},null,8,["modelValue"])])):(l(),C("div",{key:4,class:"truncate text-base",onClick:F=>m("applyFilter",{event:F,idx:v,column:a,item:s,firstColumn:g.columns[0]})},z(D),9,ze))]),_:2},1032,["item"]))]),_:1},8,["rows"]),_(h(me),null,{actions:y(({selections:v,unselectAll:a})=>[_(h(ye),{options:t.value.bulkActions(v,a)},{default:y(()=>[_(w,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},8,["class","columns","rows","options"]),c.value?(l(),x(h(ke),{key:0,class:"border-t sm:px-5 px-3 py-2",modelValue:c.value,"onUpdate:modelValue":n[2]||(n[2]=v=>c.value=v),options:{rowCount:g.options.rowCount,totalCount:g.options.totalCount},onLoadMore:n[3]||(n[3]=v=>m("loadMore"))},null,8,["modelValue","options"])):V("",!0),_(pe,{ref_key:"listBulkActionsRef",ref:t,modelValue:p.value,"onUpdate:modelValue":n[4]||(n[4]=v=>p.value=v),doctype:"Design"},null,8,["modelValue"])],64)}}},T=(g,f,b,m,d)=>{var e;const c=parseFloat(f),p=parseFloat(b),o=parseFloat(m),r=parseFloat(d);if(!/^\d*\.?\d*$/.test(f))return"Invalid Input.";if(c<p||c>o)return`Value should be between ${b} and ${m}`;const i=((e=d.toString().split(".")[1])==null?void 0:e.length)||0,t=(f.toString().includes(".")?f.split(".")[1].length:0)||0;if(i>0){if(c===p||c===o)return null;if(t!==i)return`Value should increment by ${d}`}else{if(f.toString().includes(".")&&f.toString().split(".")[1].length===0)return"Invalid Input.";if((c-p)%r!==0)return`Value should increment by ${d}`}return null};const Le={key:0},Re=["min","max","step","onUpdate:modelValue","onInput","onChange","onBlur"],Ae=["id","onInput"],Ee={key:0,class:"text-red-500"},Se={key:1},Te={__name:"CpqFields",props:{sections:Array,data:Object},setup(g){J();const f=g,b=W({}),m=(o,r)=>{f.data[o]=r;const i=document.getElementById(o);i&&(i.innerHTML=r)},d=(o,r,i,t,e)=>{const n=T(o,r,i,t,e);b[o]=n,f.data[o]=r},c=(o,r,i,t,e)=>{const n=T(o,r,i,t,e);b[o]=n,f.data[o]=r;const w=document.getElementsByClassName(o);w.length>0&&(w[0].value=r)},p=()=>{for(const o of f.sections)for(const r of o.fields)if(r.type==="Range"){const i=r.name,t=r.min;(f.data[i]===void 0||f.data[i]===null||f.data[i]==="")&&(f.data[i]=t,c(i,t,t,r.max,r.step),m(i,t))}};return H(()=>{P(()=>f.sections,(o,r)=>{o!==r&&o.length>0&&p()})}),(o,r)=>{const i=U("FormControl");return l(),x(Ce,{sections:g.sections,data:g.data},{"custom-fields":y(({field:t,data:e})=>[t.type==="Range"?(l(),C("div",Le,[se(M("input",{type:"range",class:B(t.name),min:t.min,max:t.max,step:t.step,"onUpdate:modelValue":n=>e[t.name]=n,onInput:n=>m(t.name,n.target.value),onChange:n=>d(t.name,n.target.value,t.min,t.max,t.step),onBlur:n=>d(t.name,e[t.name],t.min,t.max,t.step),style:{width:"250px","accent-color":"black"}},null,42,Re),[[ae,e[t.name]]]),M("p",{id:t.name,class:"text-gray-600 rounded px-2",contenteditable:"true",onInput:n=>c(t.name,n.target.innerText,t.min,t.max,t.step),style:{"background-color":"#f5f5f5"}},z(e[t.name]),41,Ae),b[t.name]?(l(),C("span",Ee,z(b[t.name]),1)):V("",!0)])):t.type==="textbox"?(l(),C("div",Se,[_(i,{type:"textarea",size:"sm",variant:"subtle",placeholder:o.__(t.placeholder),disabled:!1,modelValue:e[t.name],"onUpdate:modelValue":n=>e[t.name]=n},null,8,["placeholder","modelValue","onUpdate:modelValue"])])):V("",!0)]),_:1},8,["sections","data"])}}},Pe=O(Te,[["__scopeId","data-v-d2fd8006"]]);const qe={class:"mb-4 grid grid-cols-1"},je={class:"flex items-center gap-3 text-sm text-gray-600"},Ne={class:"flex flex-row-reverse gap-2"},Oe={__name:"DesignModal",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(g){const{getUser:f}=J(),{statusOptions:b}=be(),m=E(g,"modelValue"),d=ne(),c=$(null),p=W({created_by:"",design_template:""}),o=$(!1),r=$([]),i=$([]),t=L(()=>i.value.length?[{section:"",fields:i.value}]:[]);L(()=>{let a=b("design");return p.status||(p.status=a[0].value),a});async function e(){try{const a=await j("crm.cpq.doctype.design.api.get_item_variant");r.value=a}catch(a){console.error("Error fetching transformer types:",a)}}async function n(a){try{const s=await j("crm.cpq.doctype.design.api.get_formatted_item_details",{item_name:a});i.value=s}catch(s){console.error("Error fetching item details:",s)}}const w=oe({url:"frappe.client.insert",makeParams(a){const s={},k=[];return Object.entries(a).forEach(([D,F])=>{const I=i.value.find(G=>G.name===D);["design_template","status","created_by","item"].includes(D)&&(s[D]=F),I&&k.push({attribute:I.label,attribute_value:F,numeric_values:I.numeric_values})}),{doc:{doctype:"Design",...s,design_attributes:k}}}});async function u(){o.value=!0,c.value=null;const a=R(i.value,p);if(a.length>0){c.value=`Range validation failed for: ${a.map(s=>s.name).join(", ")}`,o.value=!1;return}try{await w.submit(p,{validate(){return c.value=null,!0},onSuccess(s){ie("design_created"),o.value=!1,m.value=!1,d.push({name:"Design",params:{designId:s.name}})},onError(s){o.value=!1,c.value=s.messages?s.messages.join(`
`):s.message}})}catch(s){o.value=!1,c.value=s.message}}function R(a,s){return a.filter(k=>k.type==="range").map(k=>({name:k.name,error:T(k.name,s[k.name],k.min,k.max,k.step)})).filter(k=>k.error!==null)}function v({name:a,value:s}){p[a]=s}return H(()=>{p.created_by||(p.created_by=f().email),e()}),P(()=>p.design_template,(a,s)=>{a!==s&&n(a)}),(a,s)=>{const k=U("ErrorMessage"),D=U("Button"),F=U("Dialog");return l(),x(F,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=I=>m.value=I),options:{size:"4xl",title:a.__("Create Design")}},{"body-content":y(()=>[M("div",qe,[M("div",je,[M("div",null,z(a.__("Select Design Type")),1),_(h(le),{options:r.value,modelValue:p.design_template,"onUpdate:modelValue":s[0]||(s[0]=I=>p.design_template=I),style:{width:"200px"}},null,8,["options","modelValue"])])]),_(Pe,{class:"border-t",sections:t.value,data:p,onUpdateField:v},null,8,["sections","data"]),c.value?(l(),x(k,{key:0,class:"mt-4",message:a.__(c.value)},null,8,["message"])):V("",!0)]),actions:y(()=>[M("div",Ne,[_(D,{variant:"solid",label:a.__("Create"),loading:o.value,onClick:u},null,8,["label","loading"])])]),_:1},8,["modelValue","options"])}}},We=O(Oe,[["__scopeId","data-v-daf2d236"]]),He={key:1,class:"flex h-full items-center justify-center"},Je={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},yt={__name:"Designs",setup(g){const f=[{label:__("Designs"),route:{name:"Designs"}}],b=$(null),m=$(!1),d=$({}),c=$(1),p=$(1),o=$(20),r=$(null),i=L(()=>{var t,e;return(e=(t=d.value)==null?void 0:t.data)!=null&&e.data?d.value.data.data.map(n=>{let w={};return d.value.data.rows.forEach(u=>{w[u]=n[u]}),w}):[]});return(t,e)=>{const n=U("FeatherIcon"),w=U("Button");return l(),C(S,null,[_(Q,null,{"left-header":y(()=>[_(h(he),{items:f})]),"right-header":y(()=>{var u;return[(u=b.value)!=null&&u.customListActions?(l(),x(K,{key:0,actions:b.value.customListActions},null,8,["actions"])):V("",!0),_(w,{variant:"solid",label:t.__("Create"),onClick:e[0]||(e[0]=R=>m.value=!0)},{prefix:y(()=>[_(n,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),_(X,{ref_key:"viewControls",ref:r,modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=u=>d.value=u),loadMore:c.value,"onUpdate:loadMore":e[2]||(e[2]=u=>c.value=u),resizeColumn:p.value,"onUpdate:resizeColumn":e[3]||(e[3]=u=>p.value=u),updatedPageCount:o.value,"onUpdate:updatedPageCount":e[4]||(e[4]=u=>o.value=u),doctype:"Design"},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),d.value.data&&i.value.length?(l(),x(Be,{key:0,ref_key:"designsListView",ref:b,modelValue:d.value.data.page_length_count,"onUpdate:modelValue":e[5]||(e[5]=u=>d.value.data.page_length_count=u),list:d.value,"onUpdate:list":e[6]||(e[6]=u=>d.value=u),rows:i.value,columns:d.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:d.value.data.row_count,totalCount:d.value.data.total_count},onLoadMore:e[7]||(e[7]=()=>c.value++),onColumnWidthUpdated:e[8]||(e[8]=()=>p.value++),onUpdatePageCount:e[9]||(e[9]=u=>o.value=u),onApplyFilter:e[10]||(e[10]=u=>r.value.applyFilter(u))},null,8,["modelValue","list","rows","columns","options"])):d.value.data?(l(),C("div",He,[M("div",Je,[M("span",null,z(t.__("No Designs Found")),1),_(w,{label:t.__("Create"),onClick:e[11]||(e[11]=u=>m.value=!0)},{prefix:y(()=>[_(n,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):V("",!0),_(We,{modelValue:m.value,"onUpdate:modelValue":e[12]||(e[12]=u=>m.value=u)},null,8,["modelValue"])],64)}}};export{yt as default};
//# sourceMappingURL=Designs-9693ab71.js.map
