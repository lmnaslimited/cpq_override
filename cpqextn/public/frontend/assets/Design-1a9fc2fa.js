import{_ as K}from"./Icon-b0abef9d.js";import{_ as G,a as H}from"./SidePanelModal-05261a36.js";import{u as J,A as Q,E as X,_ as Y}from"./useActiveTabManager-eb58b00a.js";import{C as Z}from"./CommentIcon-2f8212cd.js";import{P as ee}from"./PhoneIcon-d45a62b6.js";import{h as te,v as ae,l as v,x as w,I as q,a as se,j as A,K as oe,k as T,r as ie,b as l,c as y,u as o,g as p,w as f,p as r,d as u,L as S,F as $,T as ne,e as E,t as le,f as re,n as de}from"./index-d057f33a.js";import{N as me}from"./NoteModal-46cc4fb1.js";import{W as ue}from"./WhatsAppIcon-3fd08937.js";import{I as ce}from"./IndicatorIcon-c103771d.js";import{_ as pe}from"./LayoutHeader-fe1f254b.js";import{_ as fe}from"./AssignmentModal-7b9977f2.js";import{_ as _e}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-7b2c30ed.js";import{g as ge,_ as ve}from"./view-66caf033.js";import{_ as be}from"./Section-1565df09.js";import{S as ye}from"./SectionFieldCpq-942892b4.js";import{g as xe,u as Ce,h as b,s as Ie,i as we,j as Ve}from"./UserAvatar-e49c5291.js";import{s as he}from"./statuses-72592e37.js";import{_ as Ne}from"./CustomActions-fd13eb50.js";import{c as De}from"./contacts-62bb23c5.js";import{c as ke,w as Se}from"./settings-0248bbea.js";import"./EditIcon-a130850d.js";import"./views-fe454bb1.js";import"./Dropdown.vue_vue_type_script_setup_true_lang-bf1a1150.js";import"./DragVerticalIcon-87005af9.js";import"./Switch.vue_vue_type_script_setup_true_lang-3dc67c0d.js";import"./GroupByIcon-a605d43f.js";import"./Email2Icon-e2d51718.js";import"./CalendarIcon-236853ad.js";import"./callLog-55eb7109.js";import"./MultipleAvatar-9bfce769.js";import"./Dropdown-ddb0640f.js";import"./FadedScrollableDiv-9f66556a.js";import"./FileUploader-1f4a7957.js";import"./LeadsIcon-520efb00.js";import"./DealsIcon-15068e15.js";import"./EmailTemplateModal-9954264c.js";import"./TaskModal-817b477f.js";import"./ArrowUpRightIcon-f89323ee.js";const qe={key:1,class:"flex h-full overflow-hidden"},Ae={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},Te={class:"flex flex-col overflow-y-auto"},bt={__name:"Design",props:{designId:{type:String,required:!0}},setup(U){const{$dialog:L,$socket:B,makeCall:$e}=xe();De(),he(),Ce();const d=te(),V=ae(),x=v(!1),_=U,h=v([]),R=v([]),a=w({url:"crm.cpq.doctype.design.api.get_design",params:{name:_.designId},cache:["design",_.designId],onSuccess:async t=>{let e={doc:t,$dialog:L,$socket:B,router:V,updateField:I,createToast:b,deleteDoc:z,resource:{design:a,fieldsLayout:g},call:q};Ie(t);let s=await we(t,e);h.value=s.actions||[],R.value=s.statuses||[]}});se(()=>{a.data||a.fetch().catch(t=>{})});const N=v(!1),D=v(!1),k=v(!1);function j(t,e,s){e=Array.isArray(t)?"":e,!(!Array.isArray(t)&&F(t,e))&&w({url:"frappe.client.set_value",params:{doctype:"Design",name:_.designId,fieldname:t,value:e},auto:!0,onSuccess:()=>{a.reload(),N.value=!0,b({title:__("Design updated"),icon:"check",iconClasses:"text-green-600"}),s==null||s()},onError:n=>{var i;b({title:__("Error updating design"),text:__((i=n.messages)==null?void 0:i[0]),icon:"x",iconClasses:"text-red-600"})}})}function F(t,e){var n;let s=a.data.fields_meta||{};return(n=s[t])!=null&&n.reqd&&!e?(b({title:__("Error Updating Design"),text:__("{0} is a required field",[s[t].label]),icon:"x",iconClasses:"text-red-600"}),!0):!1}const M=A(()=>{let t=[{label:__("Designs"),route:{name:"Designs"}}];if(d.query.view||d.query.viewType){let e=ge(d.query.view,d.query.viewType,"Design");e&&t.push({label:__(e.label),icon:e.icon,route:{name:"Designs",params:{viewType:d.query.viewType},query:{view:d.query.view}}})}return t.push({label:a.data.name||__("Untitled"),route:{name:"Design",params:{designId:a.data.name}}}),t});oe(()=>{var t,e;return{title:((t=a.data)==null?void 0:t.name)||((e=a.data)==null?void 0:e.name)}});const C=A(()=>[{name:"Activity",label:__("Activity"),icon:Q},{name:"Emails",label:__("Emails"),icon:X},{name:"Comments",label:__("Comments"),icon:Z},{name:"Calls",label:__("Calls"),icon:ee,condition:()=>ke.value},{name:"Tasks",label:__("Tasks"),icon:ne},{name:"Notes",label:__("Notes"),icon:me},{name:"WhatsApp",label:__("WhatsApp"),icon:ue,condition:()=>Se.value}].filter(e=>e.condition?e.condition():!0)),{tabIndex:c}=J(C,"lastDesignTab");T(C,t=>{if(t&&d.params.tabName){let e=t.findIndex(s=>s.name.toLowerCase()===d.params.tabName.toLowerCase());e!==-1&&(c.value=e)}}),T(()=>{var t;return(t=a.data)==null?void 0:t.direct_material_cost},(t,e)=>{const s=Number(t),n=Number(e);!Number.isNaN(s)&&!Number.isNaN(n)?s!==n?(console.log("Value changed:",n,s),I("total_cost",s)):console.log("No change in value:",n,s):console.log("Skipping update due to NaN value:","newCost:",s,"oldCost:",n)},{immediate:!1});const g=w({url:"crm.api.docCpq.get_sidebar_fields_with_table",cache:["fieldsLayout",_.designId],params:{doctype:"Design",name:_.designId},auto:!0}),P=()=>{x.value=!0,w({url:"crm.api.docCpq.create_item_from_design",params:{design_name:_.designId},onSuccess:t=>{x.value=!1,I("item",t),b({title:__("Item created successfully"),icon:"check",iconClasses:"text-green-600"})},onError:t=>{var e;x.value=!1,b({title:__("Error creating item"),text:__(((e=t.messages)==null?void 0:e[0])||"Failed to create item"),icon:"x",iconClasses:"text-red-600"})}}).fetch()},W=async()=>{a.data.item&&V.push({name:"Item",params:{itemId:a.data.item}})};function I(t,e,s){j(t,e,()=>{a.data[t]=e,s==null||s()})}async function z(t){await q("frappe.client.delete",{doctype:"Design",name:t}),V.push({name:"Designs"})}return(t,e)=>{var n;const s=ie("Button");return l(),y($,null,[o(a).data?(l(),p(pe,{key:0},{"left-header":f(()=>[u(o(_e),{items:M.value},{prefix:f(({item:i})=>[i.icon?(l(),p(K,{key:0,icon:i.icon,class:"mr-2 h-4"},null,8,["icon"])):r("",!0)]),_:1},8,["items"])]),"right-header":f(()=>[h.value?(l(),p(Ne,{key:0,actions:h.value},null,8,["actions"])):r("",!0),u(s,{label:o(a).data.status},{prefix:f(()=>[u(ce)]),_:1},8,["label"]),o(a).data.item?r("",!0):(l(),p(s,{key:1,label:t.__("Create Item"),variant:"solid",loading:x.value,onClick:P},null,8,["label","loading"])),o(a).data.item?(l(),p(s,{key:2,label:t.__("View Item"),variant:"solid",onClick:W},null,8,["label"])):r("",!0)]),_:1})):r("",!0),(n=o(a))!=null&&n.data?(l(),y("div",qe,[u(o(ve),{modelValue:o(c),"onUpdate:modelValue":e[3]||(e[3]=i=>S(c)?c.value=i:null),tabs:C.value},{default:f(({tab:i})=>[u(Y,{ref:"activities",doctype:"Design",tabs:C.value,reload:N.value,"onUpdate:reload":e[0]||(e[0]=m=>N.value=m),tabIndex:o(c),"onUpdate:tabIndex":e[1]||(e[1]=m=>S(c)?c.value=m:null),modelValue:o(a),"onUpdate:modelValue":e[2]||(e[2]=m=>S(a)?a.value=m:null)},null,8,["tabs","reload","tabIndex","modelValue"])]),_:1},8,["modelValue","tabs"]),u(G,{class:"flex flex-col justify-between border-l",side:"right"},{default:f(()=>[E("div",{class:"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium",onClick:e[4]||(e[4]=i=>o(Ve)(o(a).data.name))},le(t.__(o(a).data.name)),1),o(g).data?(l(),y("div",Ae,[E("div",Te,[(l(!0),y($,null,re(o(g).data,(i,m)=>(l(),y("div",{key:i.label,class:de(["flex flex-col p-3",{"border-b":m!==o(g).data.length-1}])},[u(be,{"is-opened":i.opened,label:i.label},{default:f(()=>[u(ye,{fields:i.fields,isLastSection:m==o(g).data.length-1,modelValue:o(a).data,"onUpdate:modelValue":e[5]||(e[5]=O=>o(a).data=O),onUpdate:I},null,8,["fields","isLastSection","modelValue"])]),_:2},1032,["is-opened","label"])],2))),128))])])):r("",!0)]),_:1})])):r("",!0),D.value?(l(),p(fe,{key:2,modelValue:D.value,"onUpdate:modelValue":e[6]||(e[6]=i=>D.value=i),assignees:o(a).data._assignedTo,"onUpdate:assignees":e[7]||(e[7]=i=>o(a).data._assignedTo=i),doc:o(a).data,doctype:"Design"},null,8,["modelValue","assignees","doc"])):r("",!0),k.value?(l(),p(H,{key:3,modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=i=>k.value=i),onReload:e[9]||(e[9]=()=>o(g).reload())},null,8,["modelValue"])):r("",!0)],64)}}};export{bt as default};
//# sourceMappingURL=Design-1a9fc2fa.js.map
