{"version":3,"file":"Item-ccd4967b.js","sources":["../../../../frontend/src/pages/Item.vue"],"sourcesContent":["<template>\n  <LayoutHeader v-if=\"item.data\">\n    <template #left-header>\n      <Breadcrumbs :items=\"breadcrumbs\">\n        <template #prefix=\"{ item }\">\n          <Icon v-if=\"item.icon\" :icon=\"item.icon\" class=\"mr-2 h-4\" />\n        </template>\n      </Breadcrumbs>\n    </template>\n    <template #right-header>\n      <CustomActions v-if=\"customActions\" :actions=\"customActions\" />\n    </template>\n  </LayoutHeader>\n  <div v-if=\"item?.data\" class=\"flex h-full overflow-hidden\">\n    <Tabs v-model=\"tabIndex\" v-slot=\"{ tab }\" :tabs=\"tabs\">\n      <Activities\n        ref=\"activities\"\n        doctype=\"Item\"\n        :tabs=\"tabs\"\n        v-model:reload=\"reload\"\n        v-model:tabIndex=\"tabIndex\"\n        v-model=\"item\"\n      />\n    </Tabs>\n    <Resizer class=\"flex flex-col justify-between border-l\" side=\"right\">\n      <div\n        class=\"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium\"\n        @click=\"copyToClipboard(item.data.name)\"\n      >\n        {{ __(item.data.name) }}\n      </div>\n     \n      <!-- <SLASection\n        v-if=\"item.data.sla_status\"\n        v-model=\"item.data\"\n        \n      /> -->\n      <div\n        v-if=\"fieldsLayout.data\"\n        class=\"flex flex-1 flex-col justify-between overflow-hidden\"\n      >\n        <div class=\"flex flex-col overflow-y-auto\">\n          <div\n            v-for=\"(section, i) in fieldsLayout.data\"\n            :key=\"section.label\"\n            class=\"flex flex-col p-3\"\n            :class=\"{ 'border-b': i !== fieldsLayout.data.length - 1 }\"\n          >\n            <Section :is-opened=\"section.opened\" :label=\"section.label\">\n              <SectionFieldCpq\n                :fields=\"section.fields\"\n                :isLastSection=\"i == fieldsLayout.data.length - 1\"\n                v-model=\"item.data\"\n              \n              />\n              <!-- <template v-if=\"i == 0 && isManager()\" #actions>\n                <Button\n                  variant=\"ghost\"\n                  class=\"w-7 mr-2\"\n                  @click=\"showSidePanelModal = true\"\n                >\n                  <EditIcon class=\"h-4 w-4\" />\n                </Button>\n              </template> -->\n            </Section>\n          </div>\n        </div>\n      </div>\n    </Resizer>\n  </div>\n  <AssignmentModal\n    v-if=\"showAssignmentModal\"\n    v-model=\"showAssignmentModal\"\n    v-model:assignees=\"item.data._assignedTo\"\n    :doc=\"item.data\"\n    doctype=\"Item\"\n  />\n  <SidePanelModal\n    v-if=\"showSidePanelModal\"\n    v-model=\"showSidePanelModal\"\n    @reload=\"() => fieldsLayout.reload()\"\n  />\n</template>\n<script setup>\nimport Icon from '@/components/Icon.vue'\nimport Resizer from '@/components/Resizer.vue'\nimport EditIcon from '@/components/Icons/EditIcon.vue'\nimport ActivityIcon from '@/components/Icons/ActivityIcon.vue'\nimport EmailIcon from '@/components/Icons/EmailIcon.vue'\nimport CommentIcon from '@/components/Icons/CommentIcon.vue'\nimport PhoneIcon from '@/components/Icons/PhoneIcon.vue'\nimport TaskIcon from '@/components/Icons/TaskIcon.vue'\nimport NoteIcon from '@/components/Icons/NoteIcon.vue'\nimport WhatsAppIcon from '@/components/Icons/WhatsAppIcon.vue'\nimport IndicatorIcon from '@/components/Icons/IndicatorIcon.vue'\nimport LayoutHeader from '@/components/LayoutHeader.vue'\nimport Activities from '@/components/Activities/Activities.vue'\nimport AssignmentModal from '@/components/Modals/AssignmentModal.vue'\nimport SidePanelModal from '@/components/Settings/SidePanelModal.vue'\nimport MultipleAvatar from '@/components/MultipleAvatar.vue'\nimport Section from '@/components/Section.vue'\nimport SectionFieldCpq from '@/components/SectionFieldCpq.vue'\nimport SLASection from '@/components/SLASection.vue'\nimport CustomActions from '@/components/CustomActions.vue'\nimport {\n  createToast,\n  setupAssignees,\n  setupCustomizations,\n  copyToClipboard,\n} from '@/utils'\nimport { getView } from '@/utils/view'\nimport { globalStore } from '@/stores/global'\nimport { contactsStore } from '@/stores/contacts'\nimport { statusesStore } from '@/stores/statuses'\nimport { usersStore } from '@/stores/users'\nimport { whatsappEnabled, callEnabled } from '@/composables/settings'\nimport { capture } from '@/telemetry'\nimport {\n  createResource,\n  FileUploader,\n  Dropdown,\n  Tooltip,\n  Avatar,\n  Tabs,\n  Switch,\n  Breadcrumbs,\n  call,\n  usePageMeta,\n} from 'frappe-ui'\nimport { ref, computed, onMounted, watch } from 'vue'\nimport { useRouter, useRoute } from 'vue-router'\nimport { useActiveTabManager } from '@/composables/useActiveTabManager'\n\nconst { $dialog, $socket, makeCall } = globalStore()\nconst { getContactByName, contacts } = contactsStore()\nconst { statusOptions, getLeadStatus } = statusesStore()\nconst { isManager } = usersStore()\nconst route = useRoute()\nconst router = useRouter()\nconst isItemCreating = ref(false)\n\nconst props = defineProps({\n  itemId: {\n    type: String,\n    required: true,\n  },\n})\n\nconst customActions = ref([])\nconst customStatuses = ref([])\n\nconst item = createResource({\n  url: 'crm.api.docCpq.get_item',\n  params: { name: props.itemId },\n  cache: ['item', props.itemId],\n  onSuccess: async (data) => {\n    let obj = {\n      doc: data,\n      $dialog,\n      $socket,\n      router,\n      createToast,\n      resource: {\n        item,\n        fieldsLayout,\n      },\n      call,\n    }\n    setupAssignees(data)\n    let customization = await setupCustomizations(data, obj)\n    customActions.value = customization.actions || []\n    customStatuses.value = customization.statuses || []\n  },\n})\n\nonMounted(() => {\n  if (item.data) return\n  item.fetch().catch((err) => {\n});\n})\n\nconst reload = ref(false)\nconst showAssignmentModal = ref(false)\nconst showSidePanelModal = ref(false)\n\nconst breadcrumbs = computed(() => {\n  let items = [{ label: __('Items'), route: { name: 'Items' } }]\n\n  if (route.query.view || route.query.viewType) {\n    let view = getView(route.query.view, route.query.viewType, 'Design')\n    if (view) {\n      items.push({\n        label: __(view.label),\n        icon: view.icon,\n        route: {\n          name: 'Items',\n          params: { viewType: route.query.viewType },\n          query: { view: route.query.view },\n        },\n      })\n    }\n  }\n\n  items.push({\n    label: item.data.name || __('Untitled'),\n    route: { name: 'Item', params: { itemId: item.data.name } },\n  })\n  return items\n})\n\nusePageMeta(() => {\n  return {\n    title: item.data?.name || item.data?.name,\n  }\n})\n\nconst tabs = computed(() => {\n  let tabOptions = [\n    {\n      name: 'Activity',\n      label: __('Activity'),\n      icon: ActivityIcon,\n    },\n    {\n      name: 'Emails',\n      label: __('Emails'),\n      icon: EmailIcon,\n    },\n    {\n      name: 'Comments',\n      label: __('Comments'),\n      icon: CommentIcon,\n    },\n    {\n      name: 'Calls',\n      label: __('Calls'),\n      icon: PhoneIcon,\n      condition: () => callEnabled.value,\n    },\n    {\n      name: 'Tasks',\n      label: __('Tasks'),\n      icon: TaskIcon,\n    },\n    {\n      name: 'Notes',\n      label: __('Notes'),\n      icon: NoteIcon,\n    },\n    {\n      name: 'WhatsApp',\n      label: __('WhatsApp'),\n      icon: WhatsAppIcon,\n      condition: () => whatsappEnabled.value,\n    },\n  ]\n  return tabOptions.filter((tab) => (tab.condition ? tab.condition() : true))\n})\n\nconst { tabIndex } = useActiveTabManager(tabs, 'lastItemTab')\n\nwatch(tabs, (value) => {\n  if (value && route.params.tabName) {\n    let index = value.findIndex(\n      (tab) => tab.name.toLowerCase() === route.params.tabName.toLowerCase(),\n    )\n    if (index !== -1) {\n      tabIndex.value = index\n    }\n  }\n})\n\n\nconst fieldsLayout = createResource({\n  url: 'crm.api.docCpq.get_sidebar_fields_with_table',\n  cache: ['fieldsLayout', props.itemId],\n  params: { doctype: 'Item', name: props.itemId },\n  auto: true,\n})\n\n</script>"],"names":["$dialog","$socket","makeCall","globalStore","contactsStore","statusesStore","usersStore","route","useRoute","router","useRouter","ref","props","__props","customActions","customStatuses","item","createResource","data","obj","createToast","fieldsLayout","call","setupAssignees","customization","setupCustomizations","onMounted","err","reload","showAssignmentModal","showSidePanelModal","breadcrumbs","computed","items","view","getView","usePageMeta","_a","_b","tabs","ActivityIcon","EmailIcon","CommentIcon","PhoneIcon","callEnabled","TaskIcon","NoteIcon","WhatsAppIcon","whatsappEnabled","tab","tabIndex","useActiveTabManager","watch","value","index"],"mappings":"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"}