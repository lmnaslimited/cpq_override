import{_ as ge}from"./Icon-b0abef9d.js";import{_ as be,a as ye}from"./SidePanelModal-05261a36.js";import{E as Ce}from"./EditIcon-a130850d.js";import{u as xe,A as we,E as he,_ as ke,S as Ie}from"./useActiveTabManager-eb58b00a.js";import{E as Ve}from"./Email2Icon-e2d51718.js";import{C as Le}from"./CommentIcon-2f8212cd.js";import{P as K}from"./PhoneIcon-d45a62b6.js";import{h as $e,v as ze,l as c,x as q,I as B,a as Ee,j as H,K as Se,k as Ue,r as T,b as r,c as y,u as a,g as _,w as n,p as f,d as l,L as D,F as Q,T as Me,z as Te,G as X,n as Y,e as d,t as g,C as Ae,f as Ne,E as Re}from"./index-d057f33a.js";import{N as je}from"./NoteModal-46cc4fb1.js";import{W as qe}from"./WhatsAppIcon-3fd08937.js";import{I as Be}from"./IndicatorIcon-c103771d.js";import{C as De}from"./CameraIcon-766fa774.js";import{L as Fe}from"./LinkIcon-0f36a04b.js";import{O as Oe}from"./OrganizationsIcon-321405d1.js";import{C as Pe}from"./ContactsIcon-f7db653d.js";import{_ as We}from"./LayoutHeader-fe1f254b.js";import{_ as Ge}from"./AssignmentModal-7b9977f2.js";import{_ as Je}from"./MultipleAvatar-9bfce769.js";import{_ as Z}from"./views-fe454bb1.js";import{_ as Ke}from"./Section-1565df09.js";import{S as He}from"./SLASection-51b98e40.js";import{_ as Qe}from"./CustomActions-fd13eb50.js";import{g as Xe,u as Ye,h as k,s as Ze,i as ea,j as aa,b as ta,_ as A,k as F,o as sa}from"./UserAvatar-e49c5291.js";import{g as oa,_ as la}from"./view-66caf033.js";import{c as na}from"./contacts-62bb23c5.js";import{s as ia}from"./statuses-72592e37.js";import{c as ee,w as ra}from"./settings-0248bbea.js";import{_ as da}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-7b2c30ed.js";import{_ as ae}from"./Dropdown.vue_vue_type_script_setup_true_lang-bf1a1150.js";import{F as ua}from"./FileUploader-1f4a7957.js";import{_ as te}from"./Switch.vue_vue_type_script_setup_true_lang-3dc67c0d.js";import"./DragVerticalIcon-87005af9.js";import"./CalendarIcon-236853ad.js";import"./callLog-55eb7109.js";import"./Dropdown-ddb0640f.js";import"./FadedScrollableDiv-9f66556a.js";import"./LeadsIcon-520efb00.js";import"./DealsIcon-15068e15.js";import"./EmailTemplateModal-9954264c.js";import"./TaskModal-817b477f.js";import"./ArrowUpRightIcon-f89323ee.js";import"./GroupByIcon-a605d43f.js";const ma={key:1,class:"flex h-full overflow-hidden"},ca={class:"flex items-center justify-start gap-5 border-b p-5"},_a={class:"group relative size-12"},pa={class:"z-1 absolute bottom-0.5 left-0 right-0.5 flex h-9 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},fa={class:"flex flex-col gap-2.5 truncate"},va={class:"truncate text-2xl font-medium"},ga={class:"flex gap-1.5"},ba={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},ya={class:"flex flex-col overflow-y-auto"},Ca={class:"mb-4 flex items-center gap-2 text-gray-600"},xa={class:"block text-base"},wa={class:"ml-6"},ha={class:"flex items-center justify-between text-base"},ka={key:1,class:"mt-2.5 text-base"},Ia={class:"mb-4 mt-6 flex items-center gap-2 text-gray-600"},Va={class:"block text-base"},La={class:"ml-6"},$a={class:"flex items-center justify-between text-base"},za={key:1,class:"mt-2.5 text-base"},bt={__name:"Lead",props:{leadId:{type:String,required:!0}},setup(se){const{$dialog:oe,$socket:le,makeCall:ne}=Xe(),{getContactByName:I,contacts:ie}=na(),{statusOptions:re,getLeadStatus:de}=ia(),{isManager:ue}=Ye(),v=$e(),N=ze(),V=se,R=c([]),O=c([]),s=q({url:"crm.fcrm.doctype.crm_lead.api.get_lead",params:{name:V.leadId},cache:["lead",V.leadId],onSuccess:async t=>{let e={doc:t,$dialog:oe,$socket:le,router:N,updateField:x,createToast:k,deleteDoc:pe,resource:{lead:s,fieldsLayout:C},call:B};Ze(t);let i=await ea(t,e);R.value=i.actions||[],O.value=i.statuses||[]}});Ee(()=>{s.data||s.fetch()});const j=c(!1),$=c(!1),z=c(!1);function P(t,e,i){e=Array.isArray(t)?"":e,!(!Array.isArray(t)&&me(t,e))&&q({url:"frappe.client.set_value",params:{doctype:"CRM Lead",name:V.leadId,fieldname:t,value:e},auto:!0,onSuccess:()=>{s.reload(),j.value=!0,k({title:__("Lead updated"),icon:"check",iconClasses:"text-green-600"}),i==null||i()},onError:m=>{var U;k({title:__("Error updating lead"),text:__((U=m.messages)==null?void 0:U[0]),icon:"x",iconClasses:"text-red-600"})}})}function me(t,e){var m;let i=s.data.fields_meta||{};return(m=i[t])!=null&&m.reqd&&!e?(k({title:__("Error Updating Lead"),text:__("{0} is a required field",[i[t].label]),icon:"x",iconClasses:"text-red-600"}),!0):!1}const ce=H(()=>{let t=[{label:__("Leads"),route:{name:"Leads"}}];if(v.query.view||v.query.viewType){let e=oa(v.query.view,v.query.viewType,"CRM Lead");e&&t.push({label:__(e.label),icon:e.icon,route:{name:"Leads",params:{viewType:v.query.viewType},query:{view:v.query.view}}})}return t.push({label:s.data.lead_name||__("Untitled"),route:{name:"Lead",params:{leadId:s.data.name}}}),t});Se(()=>{var t,e;return{title:((t=s.data)==null?void 0:t.lead_name)||((e=s.data)==null?void 0:e.name)}});const E=H(()=>[{name:"Activity",label:__("Activity"),icon:we},{name:"Emails",label:__("Emails"),icon:he},{name:"Comments",label:__("Comments"),icon:Le},{name:"Calls",label:__("Calls"),icon:K,condition:()=>ee.value},{name:"Tasks",label:__("Tasks"),icon:Me},{name:"Notes",label:__("Notes"),icon:je},{name:"WhatsApp",label:__("WhatsApp"),icon:qe,condition:()=>ra.value}].filter(e=>e.condition?e.condition():!0)),{tabIndex:b}=xe(E,"lastLeadTab");Ue(E,t=>{if(t&&v.params.tabName){let e=t.findIndex(i=>i.name.toLowerCase()===v.params.tabName.toLowerCase());e!==-1&&(b.value=e)}});function _e(t){let e=t.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(e))return __("Only PNG and JPG images are allowed")}const C=q({url:"crm.api.doc.get_sidebar_fields",cache:["fieldsLayout",V.leadId],params:{doctype:"CRM Lead",name:V.leadId},auto:!0});function x(t,e,i){P(t,e,()=>{s.data[t]=e,i==null||i()})}async function pe(t){await B("frappe.client.delete",{doctype:"CRM Lead",name:t}),N.push({name:"Leads"})}const S=c(!1),w=c(!1),h=c(!1),p=c(""),L=c("");async function W(t){let e=!1;if(w.value&&!p.value){k({title:__("Error"),text:__("Please select an existing contact"),icon:"x",iconClasses:"text-red-600"});return}if(h.value&&!L.value){k({title:__("Error"),text:__("Please select an existing organization"),icon:"x",iconClasses:"text-red-600"});return}if(w.value&&p.value&&(s.data.salutation=I(p.value).salutation,s.data.first_name=I(p.value).first_name,s.data.last_name=I(p.value).last_name,s.data.email_id=I(p.value).email_id,s.data.mobile_no=I(p.value).mobile_no,w.value=!1,e=!0),h.value&&L.value&&(s.data.organization=L.value,h.value=!1,e=!0),e)P({salutation:s.data.salutation,first_name:s.data.first_name,last_name:s.data.last_name,email_id:s.data.email_id,mobile_no:s.data.mobile_no,organization:s.data.organization},"",()=>W(!0)),S.value=!1;else{let i=await B("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:s.data.name});i&&(Te("convert_lead_to_deal"),t&&await ie.reload(),N.push({name:"Deal",params:{dealId:i}}))}}const G=c(null);function fe(){G.value.emailBox.show=!0}return(t,e)=>{var J;const i=T("FeatherIcon"),m=T("Button"),U=T("ErrorMessage"),ve=T("Dialog");return r(),y(Q,null,[a(s).data?(r(),_(We,{key:0},{"left-header":n(()=>[l(a(da),{items:ce.value},{prefix:n(({item:o})=>[o.icon?(r(),_(ge,{key:0,icon:o.icon,class:"mr-2 h-4"},null,8,["icon"])):f("",!0)]),_:1},8,["items"])]),"right-header":n(()=>{var o;return[R.value?(r(),_(Qe,{key:0,actions:R.value},null,8,["actions"])):f("",!0),(r(),_(X(((o=a(s).data._assignedTo)==null?void 0:o.length)==1?"Button":"div"),null,{default:n(()=>[l(Je,{avatars:a(s).data._assignedTo,onClick:e[0]||(e[0]=u=>$.value=!0)},null,8,["avatars"])]),_:1})),l(a(ae),{options:a(re)("lead",x,O.value)},{default:n(({open:u})=>[l(m,{label:a(s).data.status,class:Y(a(de)(a(s).data.status).colorClass)},{prefix:n(()=>[l(Be)]),suffix:n(()=>[l(i,{name:u?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label","class"])]),_:1},8,["options"]),l(m,{label:t.__("Convert to Deal"),variant:"solid",onClick:e[1]||(e[1]=u=>S.value=!0)},null,8,["label"])]}),_:1})):f("",!0),(J=a(s))!=null&&J.data?(r(),y("div",ma,[l(a(la),{modelValue:a(b),"onUpdate:modelValue":e[5]||(e[5]=o=>D(b)?b.value=o:null),tabs:E.value},{default:n(({tab:o})=>[l(ke,{ref_key:"activities",ref:G,doctype:"CRM Lead",tabs:E.value,reload:j.value,"onUpdate:reload":e[2]||(e[2]=u=>j.value=u),tabIndex:a(b),"onUpdate:tabIndex":e[3]||(e[3]=u=>D(b)?b.value=u:null),modelValue:a(s),"onUpdate:modelValue":e[4]||(e[4]=u=>D(s)?s.value=u:null)},null,8,["tabs","reload","tabIndex","modelValue"])]),_:1},8,["modelValue","tabs"]),l(be,{class:"flex flex-col justify-between border-l",side:"right"},{default:n(()=>[d("div",{class:"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium",onClick:e[6]||(e[6]=o=>a(aa)(a(s).data.name))},g(t.__(a(s).data.name)),1),l(a(ua),{onSuccess:e[10]||(e[10]=o=>x("image",o.file_url)),validateFile:_e},{default:n(({openFileSelector:o,error:u})=>[d("div",ca,[d("div",_a,[l(a(ta),{size:"3xl",class:"size-12",label:a(s).data.first_name||t.__("Untitled"),image:a(s).data.image},null,8,["label","image"]),(r(),_(X(a(s).data.image?a(ae):"div"),Ae(a(s).data.image?{options:[{icon:"upload",label:a(s).data.image?t.__("Change image"):t.__("Upload image"),onClick:o},{icon:"trash-2",label:t.__("Remove image"),onClick:()=>x("image","")}]}:{onClick:o},{class:"!absolute bottom-0 left-0 right-0"}),{default:n(()=>[d("div",pa,[l(De,{class:"size-4 cursor-pointer text-white"})])]),_:2},1040))]),d("div",fa,[l(a(A),{text:a(s).data.lead_name||t.__("Set first name")},{default:n(()=>[d("div",va,g(a(s).data.lead_name||t.__("Untitled")),1)]),_:1},8,["text"]),d("div",ga,[a(ee)?(r(),_(a(A),{key:0,text:t.__("Make a call")},{default:n(()=>[l(m,{class:"h-7 w-7",onClick:e[7]||(e[7]=()=>a(s).data.mobile_no?a(ne)(a(s).data.mobile_no):a(F)(t.__("No phone number set")))},{default:n(()=>[l(K,{class:"h-4 w-4"})]),_:1})]),_:1},8,["text"])):f("",!0),l(a(A),{text:t.__("Send an email")},{default:n(()=>[l(m,{class:"h-7 w-7"},{default:n(()=>[l(Ve,{class:"h-4 w-4",onClick:e[8]||(e[8]=M=>a(s).data.email?fe():a(F)(t.__("No email set")))})]),_:1})]),_:1},8,["text"]),l(a(A),{text:t.__("Go to website")},{default:n(()=>[l(m,{class:"h-7 w-7"},{default:n(()=>[l(Fe,{class:"h-4 w-4",onClick:e[9]||(e[9]=M=>a(s).data.website?a(sa)(a(s).data.website):a(F)(t.__("No website set")))})]),_:1})]),_:1},8,["text"])]),l(U,{message:t.__(u)},null,8,["message"])])])]),_:1}),a(s).data.sla_status?(r(),_(He,{key:0,modelValue:a(s).data,"onUpdate:modelValue":e[11]||(e[11]=o=>a(s).data=o),onUpdateField:x},null,8,["modelValue"])):f("",!0),a(C).data?(r(),y("div",ba,[d("div",ya,[(r(!0),y(Q,null,Ne(a(C).data,(o,u)=>(r(),y("div",{key:o.label,class:Y(["flex flex-col p-3",{"border-b":u!==a(C).data.length-1}])},[l(Ke,{"is-opened":o.opened,label:o.label},Re({default:n(()=>[l(Ie,{fields:o.fields,isLastSection:u==a(C).data.length-1,modelValue:a(s).data,"onUpdate:modelValue":e[12]||(e[12]=M=>a(s).data=M),onUpdate:x},null,8,["fields","isLastSection","modelValue"])]),_:2},[u==0&&a(ue)()?{name:"actions",fn:n(()=>[l(m,{variant:"ghost",class:"w-7 mr-2",onClick:e[13]||(e[13]=M=>z.value=!0)},{default:n(()=>[l(Ce,{class:"h-4 w-4"})]),_:1})]),key:"0"}:void 0]),1032,["is-opened","label"])],2))),128))])])):f("",!0)]),_:1})])):f("",!0),$.value?(r(),_(Ge,{key:2,modelValue:$.value,"onUpdate:modelValue":e[14]||(e[14]=o=>$.value=o),assignees:a(s).data._assignedTo,"onUpdate:assignees":e[15]||(e[15]=o=>a(s).data._assignedTo=o),doc:a(s).data,doctype:"CRM Lead"},null,8,["modelValue","assignees","doc"])):f("",!0),l(ve,{modelValue:S.value,"onUpdate:modelValue":e[20]||(e[20]=o=>S.value=o),options:{title:t.__("Convert to Deal"),size:"xl",actions:[{label:t.__("Convert"),variant:"solid",onClick:W}]}},{"body-content":n(()=>[d("div",Ca,[l(Oe,{class:"h-4 w-4"}),d("label",xa,g(t.__("Organization")),1)]),d("div",wa,[d("div",ha,[d("div",null,g(t.__("Choose Existing")),1),l(a(te),{modelValue:h.value,"onUpdate:modelValue":e[16]||(e[16]=o=>h.value=o)},null,8,["modelValue"])]),h.value?(r(),_(Z,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:L.value,doctype:"CRM Organization",onChange:e[17]||(e[17]=o=>L.value=o)},null,8,["value"])):(r(),y("div",ka,g(t.__("New organization will be created based on the data in details section")),1))]),d("div",Ia,[l(Pe,{class:"h-4 w-4"}),d("label",Va,g(t.__("Contact")),1)]),d("div",La,[d("div",$a,[d("div",null,g(t.__("Choose Existing")),1),l(a(te),{modelValue:w.value,"onUpdate:modelValue":e[18]||(e[18]=o=>w.value=o)},null,8,["modelValue"])]),w.value?(r(),_(Z,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:p.value,doctype:"Contact",onChange:e[19]||(e[19]=o=>p.value=o)},null,8,["value"])):(r(),y("div",za,g(t.__("New contact will be created based on the person's details")),1))])]),_:1},8,["modelValue","options"]),z.value?(r(),_(ye,{key:3,modelValue:z.value,"onUpdate:modelValue":e[21]||(e[21]=o=>z.value=o),onReload:e[22]||(e[22]=()=>a(C).reload())},null,8,["modelValue"])):f("",!0)],64)}}};export{bt as default};
//# sourceMappingURL=Lead-938b5f84.js.map
