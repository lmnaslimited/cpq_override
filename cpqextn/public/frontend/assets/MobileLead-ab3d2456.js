import{_ as ne}from"./Icon-b0abef9d.js";import{D as ie}from"./DetailsIcon-ef5d1277.js";import{u as re,A as de,E as ue,S as me,_ as ce}from"./useActiveTabManager-eb58b00a.js";import{C as _e}from"./CommentIcon-2f8212cd.js";import{P as pe}from"./PhoneIcon-d45a62b6.js";import{h as fe,v as ve,l as m,x as E,I as M,a as be,j as W,k as ye,r as N,b as n,c,u as s,g as _,w as p,p as v,G as ge,e as r,d as i,L as R,F as G,T as xe,n as H,f as Ce,t as C}from"./index-d057f33a.js";import{N as we}from"./NoteModal-46cc4fb1.js";import{W as he}from"./WhatsAppIcon-3fd08937.js";import{I as Ie}from"./IndicatorIcon-c103771d.js";import{O as Ve}from"./OrganizationsIcon-321405d1.js";import{C as Le}from"./ContactsIcon-f7db653d.js";import{_ as ke}from"./LayoutHeader-fe1f254b.js";import{_ as Te}from"./AssignmentModal-7b9977f2.js";import{_ as ze}from"./MultipleAvatar-9bfce769.js";import{_ as J}from"./views-fe454bb1.js";import{_ as Ae}from"./Section-1565df09.js";import{S as Se}from"./SLASection-51b98e40.js";import{_ as Ue}from"./CustomActions-fd13eb50.js";import{g as $e,h as w,s as De,i as Ee}from"./UserAvatar-e49c5291.js";import{g as Me,_ as Ne}from"./view-66caf033.js";import{c as Re}from"./contacts-62bb23c5.js";import{s as qe}from"./statuses-72592e37.js";import{i as Oe,c as Be,w as je}from"./settings-0248bbea.js";import{_ as Fe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-7b2c30ed.js";import{_ as Pe}from"./Dropdown.vue_vue_type_script_setup_true_lang-bf1a1150.js";import{_ as K}from"./Switch.vue_vue_type_script_setup_true_lang-3dc67c0d.js";import"./Email2Icon-e2d51718.js";import"./CalendarIcon-236853ad.js";import"./callLog-55eb7109.js";import"./Dropdown-ddb0640f.js";import"./FadedScrollableDiv-9f66556a.js";import"./FileUploader-1f4a7957.js";import"./LeadsIcon-520efb00.js";import"./DealsIcon-15068e15.js";import"./EmailTemplateModal-9954264c.js";import"./TaskModal-817b477f.js";import"./ArrowUpRightIcon-f89323ee.js";import"./GroupByIcon-a605d43f.js";const We={class:"relative flex h-12 items-center justify-between gap-2 py-2.5 pl-5"},Ge={class:"absolute right-0"},He={key:1,class:"flex h-12 items-center justify-between gap-2 border-b px-3 py-2.5"},Je={class:"flex items-center gap-2"},Ke={key:2,class:"flex h-full overflow-hidden"},Qe={key:0},Xe={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},Ye={class:"flex flex-col overflow-y-auto"},Ze={class:"mb-4 flex items-center gap-2 text-gray-600"},ea={class:"block text-base"},aa={class:"ml-6"},ta={class:"flex items-center justify-between text-base"},sa={key:1,class:"mt-2.5 text-base"},oa={class:"mb-4 mt-6 flex items-center gap-2 text-gray-600"},la={class:"block text-base"},na={class:"ml-6"},ia={class:"flex items-center justify-between text-base"},ra={key:1,class:"mt-2.5 text-base"},Ha={__name:"MobileLead",props:{leadId:{type:String,required:!0}},setup(Q){const{$dialog:X,$socket:Y}=$e(),{getContactByName:h,contacts:Z}=Re(),{statusOptions:ee,getLeadStatus:ae}=qe(),f=fe(),U=ve(),I=Q,$=m([]),q=m([]),a=E({url:"crm.fcrm.doctype.crm_lead.api.get_lead",params:{name:I.leadId},cache:["lead",I.leadId],onSuccess:async t=>{let e={doc:t,$dialog:X,$socket:Y,router:U,updateField:z,createToast:w,deleteDoc:oe,resource:{lead:a,fieldsLayout:V},call:M};De(t);let l=await Ee(t,e);$.value=l.actions||[],q.value=l.statuses||[]}});be(()=>{a.data||a.fetch()});const D=m(!1),k=m(!1);function O(t,e,l){e=Array.isArray(t)?"":e,!(!Array.isArray(t)&&te(t,e))&&E({url:"frappe.client.set_value",params:{doctype:"CRM Lead",name:I.leadId,fieldname:t,value:e},auto:!0,onSuccess:()=>{a.reload(),D.value=!0,w({title:__("Lead updated"),icon:"check",iconClasses:"text-green-600"}),l==null||l()},onError:y=>{var S;w({title:__("Error updating lead"),text:__((S=y.messages)==null?void 0:S[0]),icon:"x",iconClasses:"text-red-600"})}})}function te(t,e){var y;let l=a.data.fields_meta||{};return(y=l[t])!=null&&y.reqd&&!e?(w({title:__("Error Updating Lead"),text:__("{0} is a required field",[l[t].label]),icon:"x",iconClasses:"text-red-600"}),!0):!1}const se=W(()=>{let t=[{label:__("Leads"),route:{name:"Leads"}}];if(f.query.view||f.query.viewType){let e=Me(f.query.view,f.query.viewType,"CRM Lead");e&&t.push({label:__(e.label),icon:e.icon,route:{name:"Leads",params:{viewType:f.query.viewType},query:{view:f.query.view}}})}return t.push({label:a.data.lead_name||__("Untitled"),route:{name:"Lead",params:{leadId:a.data.name}}}),t}),T=W(()=>[{name:"Details",label:__("Details"),icon:ie,condition:()=>Oe.value},{name:"Activity",label:__("Activity"),icon:de},{name:"Emails",label:__("Emails"),icon:ue},{name:"Comments",label:__("Comments"),icon:_e},{name:"Calls",label:__("Calls"),icon:pe,condition:()=>Be.value},{name:"Tasks",label:__("Tasks"),icon:xe},{name:"Notes",label:__("Notes"),icon:we},{name:"WhatsApp",label:__("WhatsApp"),icon:he,condition:()=>je.value}].filter(e=>e.condition?e.condition():!0)),{tabIndex:b}=re(T,"lastLeadTab");ye(T,t=>{if(t&&f.params.tabName){let e=t.findIndex(l=>l.name.toLowerCase()===f.params.tabName.toLowerCase());e!==-1&&(b.value=e)}});const V=E({url:"crm.api.doc.get_sidebar_fields",cache:["fieldsLayout",I.leadId],params:{doctype:"CRM Lead",name:I.leadId},auto:!0});function z(t,e,l){O(t,e,()=>{a.data[t]=e,l==null||l()})}async function oe(t){await M("frappe.client.delete",{doctype:"CRM Lead",name:t}),U.push({name:"Leads"})}const A=m(!1),g=m(!1),x=m(!1),u=m(""),L=m("");async function B(t){let e=!1;if(g.value&&!u.value){w({title:__("Error"),text:__("Please select an existing contact"),icon:"x",iconClasses:"text-red-600"});return}if(x.value&&!L.value){w({title:__("Error"),text:__("Please select an existing organization"),icon:"x",iconClasses:"text-red-600"});return}if(g.value&&u.value&&(a.data.salutation=h(u.value).salutation,a.data.first_name=h(u.value).first_name,a.data.last_name=h(u.value).last_name,a.data.email_id=h(u.value).email_id,a.data.mobile_no=h(u.value).mobile_no,g.value=!1,e=!0),x.value&&L.value&&(a.data.organization=L.value,x.value=!1,e=!0),e)O({salutation:a.data.salutation,first_name:a.data.first_name,last_name:a.data.last_name,email_id:a.data.email_id,mobile_no:a.data.mobile_no,organization:a.data.organization},"",()=>B(!0)),A.value=!1;else{let l=await M("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:a.data.name});l&&(t&&await Z.reload(),U.push({name:"Deal",params:{dealId:l}}))}}return(t,e)=>{var j,F;const l=N("FeatherIcon"),y=N("Button"),S=N("Dialog");return n(),c(G,null,[s(a).data?(n(),_(ke,{key:0},{default:p(()=>[r("header",We,[i(s(Fe),{items:se.value},{prefix:p(({item:o})=>[o.icon?(n(),_(ne,{key:0,icon:o.icon,class:"mr-2 h-4"},null,8,["icon"])):v("",!0)]),_:1},8,["items"]),r("div",Ge,[i(s(Pe),{options:s(ee)("lead",z,q.value)},{default:p(({open:o})=>[i(y,{label:s(a).data.status,class:H(s(ae)(s(a).data.status).colorClass)},{prefix:p(()=>[i(Ie)]),suffix:p(()=>[i(l,{name:o?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label","class"])]),_:1},8,["options"])])])]),_:1})):v("",!0),s(a).data?(n(),c("div",He,[(n(),_(ge(((j=s(a).data._assignedTo)==null?void 0:j.length)==1?"Button":"div"),null,{default:p(()=>[i(ze,{avatars:s(a).data._assignedTo,onClick:e[0]||(e[0]=o=>k.value=!0)},null,8,["avatars"])]),_:1})),r("div",Je,[$.value?(n(),_(Ue,{key:0,actions:$.value},null,8,["actions"])):v("",!0),i(y,{label:t.__("Convert"),variant:"solid",onClick:e[1]||(e[1]=o=>A.value=!0)},null,8,["label"])])])):v("",!0),(F=s(a))!=null&&F.data?(n(),c("div",Ke,[i(s(Ne),{modelValue:s(b),"onUpdate:modelValue":e[7]||(e[7]=o=>R(b)?b.value=o:null),tabs:T.value,tablistClass:"!px-3",class:"overflow-auto"},{default:p(({tab:o})=>[o.name=="Details"?(n(),c("div",Qe,[s(a).data.sla_status?(n(),_(Se,{key:0,modelValue:s(a).data,"onUpdate:modelValue":e[2]||(e[2]=d=>s(a).data=d),onUpdateField:z},null,8,["modelValue"])):v("",!0),s(V).data?(n(),c("div",Xe,[r("div",Ye,[(n(!0),c(G,null,Ce(s(V).data,(d,P)=>(n(),c("div",{key:d.label,class:H(["flex flex-col px-2 py-3 sm:p-3",{"border-b":P!==s(V).data.length-1}])},[i(Ae,{"is-opened":d.opened,label:d.label},{default:p(()=>[i(me,{fields:d.fields,isLastSection:P==s(V).data.length-1,modelValue:s(a).data,"onUpdate:modelValue":e[3]||(e[3]=le=>s(a).data=le),onUpdate:z},null,8,["fields","isLastSection","modelValue"])]),_:2},1032,["is-opened","label"])],2))),128))])])):v("",!0)])):(n(),_(ce,{key:1,doctype:"CRM Lead",tabs:T.value,reload:D.value,"onUpdate:reload":e[4]||(e[4]=d=>D.value=d),tabIndex:s(b),"onUpdate:tabIndex":e[5]||(e[5]=d=>R(b)?b.value=d:null),modelValue:s(a),"onUpdate:modelValue":e[6]||(e[6]=d=>R(a)?a.value=d:null)},null,8,["tabs","reload","tabIndex","modelValue"]))]),_:1},8,["modelValue","tabs"])])):v("",!0),k.value?(n(),_(Te,{key:3,modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=o=>k.value=o),assignees:s(a).data._assignedTo,"onUpdate:assignees":e[9]||(e[9]=o=>s(a).data._assignedTo=o),doc:s(a).data,doctype:"CRM Lead"},null,8,["modelValue","assignees","doc"])):v("",!0),i(S,{modelValue:A.value,"onUpdate:modelValue":e[14]||(e[14]=o=>A.value=o),options:{title:t.__("Convert to Deal"),size:"xl",actions:[{label:t.__("Convert"),variant:"solid",onClick:B}]}},{"body-content":p(()=>[r("div",Ze,[i(Ve,{class:"h-4 w-4"}),r("label",ea,C(t.__("Organization")),1)]),r("div",aa,[r("div",ta,[r("div",null,C(t.__("Choose Existing")),1),i(s(K),{modelValue:x.value,"onUpdate:modelValue":e[10]||(e[10]=o=>x.value=o)},null,8,["modelValue"])]),x.value?(n(),_(J,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:L.value,doctype:"CRM Organization",onChange:e[11]||(e[11]=o=>L.value=o)},null,8,["value"])):(n(),c("div",sa,C(t.__("New organization will be created based on the data in details section")),1))]),r("div",oa,[i(Le,{class:"h-4 w-4"}),r("label",la,C(t.__("Contact")),1)]),r("div",na,[r("div",ia,[r("div",null,C(t.__("Choose Existing")),1),i(s(K),{modelValue:g.value,"onUpdate:modelValue":e[12]||(e[12]=o=>g.value=o)},null,8,["modelValue"])]),g.value?(n(),_(J,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:u.value,doctype:"Contact",onChange:e[13]||(e[13]=o=>u.value=o)},null,8,["value"])):(n(),c("div",ra,C(t.__("New contact will be created based on the person's details")),1))])]),_:1},8,["modelValue","options"])],64)}}};export{Ha as default};
//# sourceMappingURL=MobileLead-ab3d2456.js.map
