import{_ as oe}from"./Icon-b0abef9d.js";import{_ as te}from"./LayoutHeader-fe1f254b.js";import{_ as ne,W as ie,T as se,M as le}from"./OrganizationModal-b81f6dbb.js";import{_ as re}from"./QuickEntryModal-6386ea24.js";import{_ as me}from"./DealsListView-e9610059.js";import{_ as ce}from"./ContactsListView-141c98a3.js";import{E as de}from"./EditIcon-a130850d.js";import{C as ue}from"./CameraIcon-766fa774.js";import{D as _e}from"./DealsIcon-15068e15.js";import{C as ge}from"./ContactsIcon-f7db653d.js";import{g as pe,u as fe,e as E,d as q,t as B,b as ye,c as $}from"./UserAvatar-e49c5291.js";import{s as be}from"./statuses-72592e37.js";import{g as he,_ as ve}from"./view-66caf033.js";import{l as z,h as we,v as ze,J as xe,j as h,K as ke,B as F,a5 as T,r as x,b as i,c,u as a,g as d,w as u,p as s,d as l,L as Ce,F as Ie,I as j,e as r,C as Oe,G as I,t as _,H as N,n as U}from"./index-d057f33a.js";import{_ as Me}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-7b2c30ed.js";import{_ as De}from"./Dropdown.vue_vue_type_script_setup_true_lang-bf1a1150.js";import{F as Re}from"./FileUploader-1f4a7957.js";import"./Fields-6a34413d.js";import"./NestedPopover-545deb9d.js";import"./IndicatorIcon-c103771d.js";import"./views-fe454bb1.js";import"./AddressModal-ced65781.js";import"./OrganizationsIcon-321405d1.js";import"./DragVerticalIcon-87005af9.js";import"./Switch.vue_vue_type_script_setup_true_lang-3dc67c0d.js";import"./GroupByIcon-a605d43f.js";import"./ListBulkActions-4e019d04.js";import"./AssignmentModal-7b9977f2.js";import"./MultipleAvatar-9bfce769.js";import"./PhoneIcon-d45a62b6.js";import"./ListRows-b9dc126d.js";import"./ListFooter-8173dedc.js";const Ve={key:1,class:"flex flex-1 flex-col overflow-hidden"},Ee={class:"flex items-start justify-start gap-6 p-5 sm:items-center"},qe={class:"group relative h-24 w-24"},Be={class:"z-1 absolute bottom-0 left-0 right-0 flex h-13 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},$e={class:"flex flex-col justify-center gap-2 sm:gap-0.5"},Fe={class:"text-3xl font-semibold text-gray-900"},Te={class:"flex flex-col flex-wrap gap-3 text-base text-gray-700 sm:flex-row sm:items-center sm:gap-2"},je={key:0,class:"flex items-center gap-1.5"},Ne={class:""},Ue={key:1,class:"hidden text-3xl leading-[0] text-gray-600 sm:flex"},Le={key:2,class:"flex items-center gap-1.5"},Se={class:""},Ae={key:3,class:"hidden text-3xl leading-[0] text-gray-600 sm:flex"},Pe={key:4,class:"flex items-center gap-1.5"},Ge={class:""},Je={key:5,class:"hidden text-3xl leading-[0] text-gray-600 sm:flex"},We={key:6,class:"flex items-center gap-1.5"},He={class:""},Ke={key:7,class:"hidden text-3xl leading-[0] text-gray-600 sm:flex"},Qe={class:"mt-2 flex gap-1.5"},Xe={key:2,class:"grid flex-1 place-items-center text-xl font-medium text-gray-500"},Ye={class:"flex flex-col items-center justify-center space-y-3"},Va={__name:"Organization",props:{organizationId:{type:String,required:!0}},setup(L){const m=L,{$dialog:S}=pe(),{getDealStatus:A}=be(),v=z(!1),p=z(!1),k=z(!1),g=we(),P=ze(),o=xe({doctype:"CRM Organization",name:m.organizationId,cache:["organization",m.organizationId],fields:["*"],auto:!0}),G=h(()=>{let e=[{label:__("Organizations"),route:{name:"Organizations"}}];if(g.query.view||g.query.viewType){let t=he(g.query.view,g.query.viewType,"CRM Organization");t&&e.push({label:__(t.label),icon:t.icon,route:{name:"Organizations",params:{viewType:g.query.viewType},query:{view:g.query.view}}})}return e.push({label:m.organizationId,route:{name:"Organization",params:{organizationId:m.organizationId}}}),e});ke(()=>({title:m.organizationId}));function J(e){let t=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(t))return __("Only PNG and JPG images are allowed")}async function O(e){await j("frappe.client.set_value",{doctype:"CRM Organization",name:m.organizationId,fieldname:"organization_logo",value:(e==null?void 0:e.file_url)||""}),o.reload()}async function W(){S({title:__("Delete organization"),message:__("Are you sure you want to delete this organization?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await j("frappe.client.delete",{doctype:"CRM Organization",name:m.organizationId}),e(),P.push({name:"Organizations"})}}]})}function H(e){return e&&e.replace(/^(?:https?:\/\/)?(?:www\.)?/i,"")}const f=z(0),K=[{label:"Deals",icon:F(_e,{class:"h-4 w-4"}),count:h(()=>{var e;return(e=D.data)==null?void 0:e.length})},{label:"Contacts",icon:F(ge,{class:"h-4 w-4"}),count:h(()=>{var e;return(e=R.data)==null?void 0:e.length})}],{getUser:M}=fe(),D=T({type:"list",doctype:"CRM Deal",cache:["deals",m.organizationId],fields:["name","organization","currency","annual_revenue","status","email","mobile_no","deal_owner","modified"],filters:{organization:m.organizationId},orderBy:"modified desc",pageLength:20,auto:!0}),R=T({type:"list",doctype:"Contact",cache:["contacts",m.organizationId],fields:["name","full_name","image","email_id","mobile_no","company_name","modified"],filters:{company_name:m.organizationId},orderBy:"modified desc",pageLength:20,auto:!0}),y=h(()=>{let e=[];return e=f.value?R:D,e.data?e.data.map(t=>f.value?X(t):Q(t)):[]}),V=h(()=>f.value===0?Y:Z);function Q(e){var t,b;return{name:e.name,organization:{label:e.organization,logo:(t=m.organization)==null?void 0:t.organization_logo},annual_revenue:E(e.annual_revenue,e.currency),status:{label:e.status,color:(b=A(e.status))==null?void 0:b.iconColorClass},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&M(e.deal_owner).full_name,...e.deal_owner&&M(e.deal_owner)},modified:{label:q(e.modified,$),timeAgo:__(B(e.modified))}}}function X(e){var t;return{name:e.name,full_name:{label:e.full_name,image_label:e.full_name,image:e.image},email:e.email_id,mobile_no:e.mobile_no,company_name:{label:e.company_name,logo:(t=m.organization)==null?void 0:t.organization_logo},modified:{label:q(e.modified,$),timeAgo:__(B(e.modified))}}}const Y=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}],Z=[{label:__("Name"),key:"full_name",width:"17rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Phone"),key:"mobile_no",width:"12rem"},{label:__("Organization"),key:"company_name",width:"12rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];return(e,t)=>{const b=x("FeatherIcon"),C=x("Button"),ee=x("ErrorMessage"),ae=x("Badge");return i(),c(Ie,null,[a(o).doc?(i(),d(te,{key:0},{"left-header":u(()=>[l(a(Me),{items:G.value},{prefix:u(({item:n})=>[n.icon?(i(),d(oe,{key:0,icon:n.icon,class:"mr-2 h-4"},null,8,["icon"])):s("",!0)]),_:1},8,["items"])]),_:1})):s("",!0),a(o).doc?(i(),c("div",Ve,[l(a(Re),{onSuccess:O,validateFile:J},{default:u(({openFileSelector:n,error:w})=>[r("div",Ee,[r("div",qe,[l(a(ye),{size:"3xl",image:a(o).doc.organization_logo,label:a(o).doc.name,class:"!h-24 !w-24"},null,8,["image","label"]),(i(),d(I(a(o).doc.organization_logo?a(De):"div"),Oe(a(o).doc.organization_logo?{options:[{icon:"upload",label:a(o).doc.organization_logo?e.__("Change image"):e.__("Upload image"),onClick:n},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>O("")}]}:{onClick:n},{class:"!absolute bottom-0 left-0 right-0"}),{default:u(()=>[r("div",Be,[l(ue,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:2},1040))]),r("div",$e,[r("div",Fe,_(a(o).doc.name),1),r("div",Te,[a(o).doc.website?(i(),c("div",je,[l(ie,{class:"h-4 w-4"}),r("span",Ne,_(H(a(o).doc.website)),1)])):s("",!0),a(o).doc.website?(i(),c("span",Ue," 路 ")):s("",!0),a(o).doc.industry?(i(),c("div",Le,[l(b,{name:"briefcase",class:"h-4 w-4"}),r("span",Se,_(a(o).doc.industry),1)])):s("",!0),a(o).doc.industry?(i(),c("span",Ae," 路 ")):s("",!0),a(o).doc.territory?(i(),c("div",Pe,[l(se,{class:"h-4 w-4"}),r("span",Ge,_(a(o).doc.territory),1)])):s("",!0),a(o).doc.territory?(i(),c("span",Je," 路 ")):s("",!0),a(o).doc.annual_revenue?(i(),c("div",We,[l(le,{class:"size-4"}),r("span",He,_(a(E)(a(o).doc.annual_revenue,a(o).doc.currency)),1)])):s("",!0),a(o).doc.annual_revenue?(i(),c("span",Ke," 路 ")):s("",!0),a(o).doc.website||a(o).doc.industry||a(o).doc.territory||a(o).doc.annual_revenue?(i(),d(C,{key:8,variant:"ghost",label:e.__("More"),class:"w-fit cursor-pointer hover:text-gray-900 sm:-ml-1",onClick:t[0]||(t[0]=()=>{k.value=!0,v.value=!0})},null,8,["label"])):s("",!0)]),r("div",Qe,[l(C,{label:e.__("Edit"),size:"sm",onClick:t[1]||(t[1]=()=>{k.value=!1,v.value=!0})},{prefix:u(()=>[l(de,{class:"h-4 w-4"})]),_:1},8,["label"]),l(C,{label:e.__("Delete"),theme:"red",size:"sm",onClick:W},{prefix:u(()=>[l(b,{name:"trash-2",class:"h-4 w-4"})]),_:1},8,["label"])]),l(ee,{class:"mt-2",message:e.__(w)},null,8,["message"])])])]),_:1}),l(a(ve),{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=n=>f.value=n),tabs:K},{tab:u(({tab:n,selected:w})=>[r("button",{class:U(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-gray-600 duration-300 ease-in-out hover:border-gray-400 hover:text-gray-900",{"text-gray-900":w}])},[n.icon?(i(),d(I(n.icon),{key:0,class:"h-5"})):s("",!0),N(" "+_(e.__(n.label))+" ",1),l(ae,{class:U(["group-hover:bg-gray-900",[w?"bg-gray-900":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:u(()=>[N(_(n.count),1)]),_:2},1032,["class"])],2)]),default:u(({tab:n})=>[n.label==="Deals"&&y.value.length?(i(),d(me,{key:0,class:"mt-4",rows:y.value,columns:V.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):s("",!0),n.label==="Contacts"&&y.value.length?(i(),d(ce,{key:1,class:"mt-4",rows:y.value,columns:V.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):s("",!0),y.value.length?s("",!0):(i(),c("div",Xe,[r("div",Ye,[(i(),d(I(n.icon),{class:"!h-10 !w-10"})),r("div",null,_(e.__("No {0} Found",[e.__(n.label)])),1)])]))]),_:1},8,["modelValue"])])):s("",!0),l(ne,{modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=n=>v.value=n),quickEntry:p.value,"onUpdate:quickEntry":t[4]||(t[4]=n=>p.value=n),organization:a(o),"onUpdate:organization":t[5]||(t[5]=n=>Ce(o)?o.value=n:null),options:{detailMode:k.value}},null,8,["modelValue","quickEntry","organization","options"]),p.value?(i(),d(re,{key:2,modelValue:p.value,"onUpdate:modelValue":t[6]||(t[6]=n=>p.value=n),doctype:"CRM Organization"},null,8,["modelValue"])):s("",!0)],64)}}};export{Va as default};
//# sourceMappingURL=Organization-f5ec1475.js.map
